<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BANGBIN_7KAIH - Modern UI</title>
    <!-- Google Fonts: Inter & Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@500;600;700;800&display=swap" rel="stylesheet">
    <!-- Icon Awesome (FontAwesome) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/x-icon" href="https://lh3.googleusercontent.com/d/16rll5zsRdwTbR3nF_NmPKwY51tg4tnOn">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        heading: ['Poppins', 'sans-serif'],
                    },
                    colors: {
                        primary: '#4f46e5', // Indigo 600
                        secondary: '#0ea5e9', // Sky 500
                        accent: '#f59e0b', // Amber 500
                    },
                    animation: {
                        'fade-in-up': 'fadeInUp 0.5s ease-out forwards',
                        'bounce-slight': 'bounceSlight 2s infinite',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        bounceSlight: {
                            '0%, 100%': { transform: 'translateY(-5%)' },
                            '50%': { transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    <!-- PDF & Excel Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0e7ff 100%);
            min-height: 100vh;
        }
        
        /* Glassmorphism Cards */
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.05);
        }

        /* Nav Active State */
        nav a {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        nav a.active {
            background: linear-gradient(90deg, #4f46e5 0%, #6366f1 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
            transform: translateY(-2px);
        }
        nav a:hover:not(.active) {
            background-color: #eef2ff;
            color: #4f46e5;
            transform: translateY(-1px);
        }

        /* Page Transitions */
        .page { display: none; }
        .page.active { 
            display: block; 
            animation: fadeInUp 0.5s ease-out forwards;
        }

        /* Custom Checkbox */
        input[type="checkbox"] {
            appearance: none;
            background-color: #fff;
            margin: 0;
            font: inherit;
            color: currentColor;
            width: 1.4em;
            height: 1.4em;
            border: 2px solid #cbd5e1;
            border-radius: 0.35em;
            display: grid;
            place-content: center;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        input[type="checkbox"]::before {
            content: "";
            width: 0.75em;
            height: 0.75em;
            transform: scale(0);
            transition: 120ms transform ease-in-out;
            box-shadow: inset 1em 1em white;
            transform-origin: center;
            clip-path: polygon(14% 44%, 0 65%, 50% 100%, 100% 16%, 80% 0%, 43% 62%);
        }
        input[type="checkbox"]:checked {
            background-color: #4f46e5;
            border-color: #4f46e5;
        }
        input[type="checkbox"]:checked::before {
            transform: scale(1);
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* Modal Animation */
        .modal-overlay {
            position: fixed; inset: 0;
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(4px);
            display: flex; align-items: center; justify-content: center;
            z-index: 1000;
            opacity: 0; visibility: hidden;
            transition: all 0.3s ease-in-out;
        }
        .modal-overlay.visible {
            opacity: 1; visibility: visible;
        }
        .modal-content {
            background: white;
            transform: scale(0.9) translateY(20px);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .modal-overlay.visible .modal-content {
            transform: scale(1) translateY(0);
            opacity: 1;
        }

        /* Shake Animation */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        /* Button Gradients & Effects */
        .btn-gradient-primary {
            background: linear-gradient(135deg, #4f46e5 0%, #4338ca 100%);
            transition: all 0.3s ease;
        }
        .btn-gradient-primary:hover {
            filter: brightness(110%);
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.4);
            transform: translateY(-1px);
        }
        
        .btn-gradient-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            transition: all 0.3s ease;
        }
        .btn-gradient-success:hover {
            filter: brightness(110%);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
            transform: translateY(-1px);
        }

        .btn-gradient-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            transition: all 0.3s ease;
        }
        .btn-gradient-danger:hover {
            filter: brightness(110%);
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
            transform: translateY(-1px);
        }
    </style>
</head>
<body class="text-slate-800 antialiased selection:bg-indigo-100 selection:text-indigo-700">

    <div id="app-container" class="container mx-auto p-4 sm:p-6 lg:p-8 max-w-7xl transition-all duration-500" style="display: none;">
        <!-- Header Section -->
        <header class="glass-panel rounded-2xl p-8 mb-8 text-center relative overflow-hidden group">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-400 via-indigo-500 to-purple-500"></div>
            <div class="absolute -top-10 -left-10 w-40 h-40 bg-indigo-500 rounded-full mix-blend-multiply filter blur-3xl opacity-10 animate-blob"></div>
            <div class="absolute -bottom-10 -right-10 w-40 h-40 bg-pink-500 rounded-full mix-blend-multiply filter blur-3xl opacity-10 animate-blob animation-delay-2000"></div>
            
            <h1 class="font-heading text-3xl md:text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-blue-600 mb-2 tracking-tight">
                <i class="fas fa-child-reaching mr-2 text-indigo-500"></i>
                7 KEBIASAAN ANAK INDONESIA HEBAT
            </h1>
			
            <p class="text-slate-500 font-medium">Membangun Karakter Generasi Emas Sejak Dini</p>
        </header>
        
        <!-- Navigation -->
        <nav class="glass-panel rounded-xl shadow-lg mb-8 flex flex-wrap justify-center p-3 gap-2 sticky top-4 z-40 transition-all duration-300">
            <a href="#" onclick="showPage('sekolah')" class="px-5 py-2.5 font-semibold rounded-lg flex items-center gap-2 group">
                <i class="fas fa-school group-hover:scale-110 transition-transform"></i> Sekolah
            </a>
            <a href="#" onclick="showPage('siswa')" class="px-5 py-2.5 font-semibold rounded-lg flex items-center gap-2 group">
                <i class="fas fa-users group-hover:scale-110 transition-transform"></i> Siswa
            </a>
            <a href="#" onclick="showPage('input')" class="px-5 py-2.5 font-semibold rounded-lg flex items-center gap-2 group">
                <i class="fas fa-pen-to-square group-hover:scale-110 transition-transform"></i> Input
            </a>
            <a href="#" onclick="showPage('rekap')" class="px-5 py-2.5 font-semibold rounded-lg flex items-center gap-2 group">
                <i class="fas fa-table-list group-hover:scale-110 transition-transform"></i> Rekap
            </a>
            <a href="#" onclick="showPage('nilai')" class="px-5 py-2.5 font-semibold rounded-lg flex items-center gap-2 group">
                <i class="fas fa-star group-hover:scale-110 transition-transform"></i> Nilai
            </a>
            <a href="#" onclick="showPage('tutorial')" class="px-5 py-2.5 font-semibold rounded-lg flex items-center gap-2 group">
                <i class="fas fa-circle-question group-hover:scale-110 transition-transform"></i> Bantuan
            </a>
            <!-- Logout Button -->
            <button onclick="handleLogout()" class="px-5 py-2.5 font-semibold rounded-lg flex items-center gap-2 group text-red-600 hover:bg-red-50 hover:shadow-sm transition-all border border-transparent hover:border-red-100">
                <i class="fas fa-sign-out-alt group-hover:scale-110 transition-transform"></i> Keluar
            </button>
        </nav>

        <main class="glass-panel shadow-xl rounded-2xl p-6 md:p-8 min-h-[500px]">
            <!-- Halaman 1: Data Sekolah -->
            <div id="page-sekolah" class="page">
                <div class="flex items-center gap-3 border-b border-slate-100 pb-4 mb-6">
                    <div class="w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600">
                        <i class="fas fa-school text-xl"></i>
                    </div>
                    <h2 class="text-2xl font-heading font-bold text-slate-700">Pengaturan Sekolah</h2>
                </div>

                <form id="form-sekolah" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="group">
                            <label for="nama_sekolah" class="block text-sm font-semibold text-slate-600 mb-2 group-focus-within:text-indigo-600 transition-colors">Nama Sekolah</label>
                            <input type="text" id="nama_sekolah" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:bg-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all" required>
                        </div>
                        <div class="group">
                            <label for="kelas" class="block text-sm font-semibold text-slate-600 mb-2 group-focus-within:text-indigo-600 transition-colors">Kelas</label>
                            <input type="text" id="kelas" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:bg-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all" required>
                        </div>
                        <div class="group">
                            <label for="nama_guru" class="block text-sm font-semibold text-slate-600 mb-2 group-focus-within:text-indigo-600 transition-colors">Nama Guru</label>
                            <input type="text" id="nama_guru" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:bg-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all" required>
                        </div>
                        <div class="group">
                            <label for="nip_guru" class="block text-sm font-semibold text-slate-600 mb-2 group-focus-within:text-indigo-600 transition-colors">NIP Guru</label>
                            <input type="text" id="nip_guru" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:bg-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all" required>
                        </div>
                        <div class="group">
                            <label for="nama_kepsek" class="block text-sm font-semibold text-slate-600 mb-2 group-focus-within:text-indigo-600 transition-colors">Nama Kepala Sekolah</label>
                            <input type="text" id="nama_kepsek" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:bg-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all" required>
                        </div>
                        <div class="group">
                            <label for="nip_kepsek" class="block text-sm font-semibold text-slate-600 mb-2 group-focus-within:text-indigo-600 transition-colors">NIP Kepala Sekolah</label>
                            <input type="text" id="nip_kepsek" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:bg-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all" required>
                        </div>
                        
                        <!-- PENGATURAN TANGGAL DAN KOTA -->
                         <div class="p-6 bg-gradient-to-br from-amber-50 to-orange-50 rounded-2xl border border-amber-100 md:col-span-2 shadow-sm">
                            <h3 class="font-bold text-amber-700 mb-4 flex items-center gap-2">
                                <i class="fas fa-print"></i> Pengaturan Cetak PDF
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="kota_sekolah" class="block text-sm font-medium text-amber-800 mb-1">Nama Kota (Titi Mangsa)</label>
                                    <input type="text" id="kota_sekolah" placeholder="Contoh: Jakarta" class="w-full p-2.5 bg-white border border-amber-200 rounded-lg focus:ring-2 focus:ring-amber-400 outline-none">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-amber-800 mb-1">Tanggal Cetak</label>
                                    <div class="flex items-center gap-2 mb-2">
                                        <input type="checkbox" id="use_manual_date">
                                        <label for="use_manual_date" class="text-sm text-amber-900 cursor-pointer font-medium">Gunakan Tanggal Custom</label>
                                    </div>
                                    <input type="date" id="tanggal_cetak_manual" class="w-full p-2.5 bg-white border border-amber-200 rounded-lg focus:ring-2 focus:ring-amber-400 outline-none disabled:bg-slate-100 disabled:text-slate-400 transition-colors" disabled>
                                </div>
                            </div>
                        </div>

                        <div class="group">
                            <label for="jumlah_ibadah" class="block text-sm font-semibold text-slate-600 mb-2 group-focus-within:text-indigo-600 transition-colors">Jumlah Ibadah (1-10)</label>
                            <input type="number" id="jumlah_ibadah" min="1" max="10" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:bg-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all" required>
                        </div>
                        <div class="group">
                            <label for="persen_capaian" class="block text-sm font-semibold text-slate-600 mb-2 group-focus-within:text-indigo-600 transition-colors">Target Capaian (%)</label>
                            <input type="number" id="persen_capaian" min="1" max="100" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:bg-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all" required>
                        </div>
                        <div class="md:col-span-2 group">
                            <label for="deskripsi_hebat" class="block text-sm font-semibold text-slate-600 mb-2 group-focus-within:text-indigo-600 transition-colors">Deskripsi Apresiasi</label>
                            <textarea id="deskripsi_hebat" rows="2" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:bg-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all"></textarea>
                        </div>
                        <!-- Security -->
                        <div class="md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="group">
                                <label for="password_sekolah" class="block text-sm font-semibold text-slate-600 mb-2 group-focus-within:text-indigo-600 transition-colors">Password Aplikasi</label>
                                <div class="relative">
                                    <input type="password" id="password_sekolah" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:bg-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all pr-10">
                                    <span class="absolute inset-y-0 right-0 flex items-center pr-3 cursor-pointer text-slate-400 hover:text-indigo-600 transition-colors" onclick="togglePasswordVisibility('password_sekolah', 'eye-icon-sekolah')">
                                        <div id="eye-icon-sekolah"><i class="fas fa-eye"></i></div>
                                    </span>
                                </div>
                            </div>
                            <div class="group">
                                <label for="phone_sekolah" class="block text-sm font-semibold text-slate-600 mb-2 group-focus-within:text-indigo-600 transition-colors">No. WhatsApp</label>
                                <input type="tel" id="phone_sekolah" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:bg-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all" placeholder="628123456789" required>
                            </div>
                        </div>
                    </div>
                    <div class="text-right pt-4 border-t border-slate-100">
                        <button type="submit" class="btn-gradient-success text-white font-bold py-3 px-8 rounded-xl shadow-lg hover:shadow-xl flex items-center gap-2 ml-auto">
                            <i class="fas fa-save"></i> Simpan Pengaturan
                        </button>
                    </div>
                </form>
            </div>

            <!-- Halaman 2: Data Siswa -->
            <div id="page-siswa" class="page">
                <div class="flex justify-between items-center border-b border-slate-100 pb-4 mb-6 flex-wrap gap-4">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600">
                            <i class="fas fa-user-graduate text-xl"></i>
                        </div>
                        <h2 class="text-2xl font-heading font-bold text-slate-700">Data Siswa</h2>
                    </div>
                    <button class="bg-emerald-50 text-emerald-600 border border-emerald-200 font-bold py-2.5 px-5 rounded-xl hover:bg-emerald-100 hover:shadow-md transition-all flex items-center gap-2" onclick="openImportModal()">
                        <i class="fas fa-file-excel text-lg"></i> Impor Excel
                    </button>
                </div>

                <form id="form-tambah-siswa" class="mb-8 p-6 bg-slate-50 rounded-2xl border border-slate-100 shadow-inner">
                    <h3 class="text-sm font-bold text-slate-400 uppercase tracking-wider mb-4">Tambah Siswa Baru</h3>
                    <div class="grid grid-cols-1 md:grid-cols-7 gap-4 items-end">
                        <div class="md:col-span-2">
                            <label for="induk_siswa" class="block text-xs font-bold text-slate-500 mb-1 uppercase">No. Induk</label>
                            <input type="number" id="induk_siswa" placeholder="Contoh: 1001" class="w-full p-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none" required>
                        </div>
                        <div class="md:col-span-3">
                            <label for="nama_siswa" class="block text-xs font-bold text-slate-500 mb-1 uppercase">Nama Lengkap</label>
                            <input type="text" id="nama_siswa" placeholder="Nama Lengkap Siswa" class="w-full p-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none" required>
                        </div>
                        <div class="md:col-span-2">
                            <button type="submit" class="w-full btn-gradient-primary text-white font-bold py-3 px-4 rounded-xl shadow-md flex justify-center items-center gap-2">
                                <i class="fas fa-plus-circle"></i> Tambah
                            </button>
                        </div>
                    </div>
                </form>
                
                <div class="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="min-w-full">
                            <thead class="bg-slate-50 border-b border-slate-100">
                                <tr>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">No</th>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">Induk</th>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">Nama Siswa</th>
                                    <th class="px-6 py-4 text-center text-xs font-bold text-slate-500 uppercase tracking-wider">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="body-tabel-siswa" class="divide-y divide-slate-100"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Halaman 3: Input Ceklis -->
            <div id="page-input" class="page">
                <div class="flex items-center gap-3 border-b border-slate-100 pb-4 mb-6">
                    <div class="w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600">
                        <i class="fas fa-list-check text-xl"></i>
                    </div>
                    <h2 class="text-2xl font-heading font-bold text-slate-700">Input Ceklis Harian</h2>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div class="bg-blue-50 p-4 rounded-xl border border-blue-100">
                        <label for="input-tanggal" class="block text-xs font-bold text-blue-800 mb-2 uppercase flex items-center gap-2">
                            <i class="far fa-calendar-alt"></i> Pilih Tanggal
                        </label>
                        <input type="date" id="input-tanggal" class="w-full p-2.5 bg-white border border-blue-200 rounded-lg focus:ring-2 focus:ring-blue-400 outline-none text-blue-900 font-medium">
                    </div>
                    <div class="bg-slate-50 p-4 rounded-xl border border-slate-100">
                        <label for="search-siswa" class="block text-xs font-bold text-slate-600 mb-2 uppercase flex items-center gap-2">
                            <i class="fas fa-search"></i> Cari Siswa
                        </label>
                        <input type="search" id="search-siswa" placeholder="Ketik nama siswa..." class="w-full p-2.5 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-400 outline-none">
                    </div>
                </div>

                <div id="input-table-container" class="rounded-xl border border-slate-200 overflow-hidden shadow-sm">
                    <table class="min-w-full bg-white text-sm">
                        <thead class="bg-slate-50 sticky top-0 z-10 shadow-sm">
                            <tr>
                                <th class="px-6 py-4 text-left font-bold text-slate-600 uppercase text-xs tracking-wider">No</th>
                                <th class="px-6 py-4 text-left font-bold text-slate-600 uppercase text-xs tracking-wider">Induk</th>
                                <th class="px-6 py-4 text-left font-bold text-slate-600 uppercase text-xs tracking-wider">Nama Siswa</th>
                                <th class="px-6 py-4 text-center font-bold text-slate-600 uppercase text-xs tracking-wider">Status</th>
                            </tr>
                        </thead>
                        <tbody id="body-input-ceklis" class="divide-y divide-slate-100"></tbody>
                    </table>
                </div>
            </div>

            <!-- Halaman 4: Rekap -->
            <div id="page-rekap" class="page">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center border-b border-slate-100 pb-4 mb-6 gap-4">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600">
                            <i class="fas fa-clipboard-list text-xl"></i>
                        </div>
                        <h2 class="text-2xl font-heading font-bold text-slate-700">Rekapitulasi</h2>
                    </div>
                    
                    <div class="flex gap-2 items-center flex-wrap bg-slate-50 p-2 rounded-xl border border-slate-100">
                        <select id="rekap-filter-siswa" class="p-2 bg-white border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500 outline-none"></select>
                        <span class="text-slate-400 text-xs px-1"><i class="fas fa-arrow-right"></i></span>
                        <input type="date" id="rekap-tanggal-mulai" class="p-2 bg-white border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500 outline-none">
                        <span class="text-slate-400 text-xs px-1">s/d</span>
                        <input type="date" id="rekap-tanggal-akhir" class="p-2 bg-white border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500 outline-none">
                    </div>
                </div>

                <div class="flex justify-end gap-3 mb-4">
                     <button class="bg-white text-red-500 border border-red-200 font-bold py-2 px-4 rounded-lg shadow-sm hover:bg-red-50 transition-all flex items-center gap-2" onclick="hapusSemuaDataRekap()">
                        <i class="fas fa-trash-alt"></i> Reset
                    </button>
                    <button class="btn-gradient-primary text-white font-bold py-2 px-6 rounded-lg shadow-md hover:shadow-lg transition-all flex items-center gap-2" onclick="downloadRekapPDF()">
                        <i class="fas fa-file-pdf"></i> Unduh PDF
                    </button>
                </div>
                
                <!-- PAGINATION CONTROLS -->
                <div class="flex flex-col sm:flex-row justify-between items-center mb-4 gap-4 bg-white p-3 rounded-xl border border-slate-100 shadow-sm">
                    <div class="flex items-center gap-2">
                        <span class="text-sm font-semibold text-slate-600">Tampilkan</span>
                        <select id="rekap-rows-per-page" class="p-1.5 border border-slate-300 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500 outline-none font-medium">
                            <option value="10">10</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                        </select>
                        <span class="text-sm font-semibold text-slate-600">data per halaman</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <button id="btn-prev-page" class="px-3 py-1.5 rounded-lg border border-slate-300 text-slate-600 hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed font-medium text-sm">
                            <i class="fas fa-chevron-left"></i> Prev
                        </button>
                        <span id="page-info" class="text-sm font-bold text-indigo-600 min-w-[100px] text-center">Hal 1 dari 1</span>
                        <button id="btn-next-page" class="px-3 py-1.5 rounded-lg border border-slate-300 text-slate-600 hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed font-medium text-sm">
                            Next <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>

                <div class="overflow-x-auto rounded-xl border border-slate-200 shadow-sm">
                    <table class="min-w-full bg-white text-sm">
                        <thead class="bg-slate-50">
                             <tr id="header-rekap">
                                <th class="px-4 py-4 text-center font-bold text-slate-600 sticky left-0 bg-slate-50 z-20 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]">NO</th>
                                <th class="px-4 py-4 text-center font-bold text-slate-600 sticky left-10 bg-slate-50 z-20 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]">Induk</th>
                                <th class="px-6 py-4 text-left font-bold text-slate-600 sticky left-24 bg-slate-50 z-20 w-48 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]">Nama Siswa</th>
                                <th class="px-6 py-4 text-center font-bold text-slate-600">Tanggal</th>
                            </tr>
                        </thead>
                        <tbody id="body-tabel-rekap" class="divide-y divide-slate-100"></tbody>
                    </table>
                </div>
            </div>

            <!-- Halaman 5: Nilai -->
            <div id="page-nilai" class="page">
                <div class="flex items-center gap-3 border-b border-slate-100 pb-4 mb-6">
                    <div class="w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600">
                        <i class="fas fa-award text-xl"></i>
                    </div>
                    <h2 class="text-2xl font-heading font-bold text-slate-700">Penilaian Akhir</h2>
                </div>

                <div class="p-6 bg-gradient-to-r from-slate-50 to-white rounded-2xl border border-slate-200 shadow-sm mb-8">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 items-end">
                        <div>
                            <label for="nilai-filter-siswa" class="block text-xs font-bold text-slate-500 mb-2 uppercase">Pilih Siswa</label>
                            <div class="relative">
                                <select id="nilai-filter-siswa" class="w-full p-3 bg-white border border-slate-200 rounded-xl appearance-none focus:ring-2 focus:ring-indigo-500 outline-none cursor-pointer"></select>
                                <div class="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none text-slate-500"><i class="fas fa-chevron-down"></i></div>
                            </div>
                        </div>
                        <div>
                            <label for="nilai-tanggal-mulai" class="block text-xs font-bold text-slate-500 mb-2 uppercase">Dari Tanggal</label>
                            <input type="date" id="nilai-tanggal-mulai" class="w-full p-3 bg-white border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none">
                        </div>
                        <div>
                            <label for="nilai-tanggal-akhir" class="block text-xs font-bold text-slate-500 mb-2 uppercase">Sampai Tanggal</label>
                            <input type="date" id="nilai-tanggal-akhir" class="w-full p-3 bg-white border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none">
                        </div>
                        <div>
                            <button class="w-full btn-gradient-success text-white font-bold py-3 px-4 rounded-xl shadow-md hover:shadow-lg flex justify-center items-center gap-2" onclick="tampilkanPenilaian()">
                                <i class="fas fa-calculator"></i> Hitung Nilai
                            </button>
                        </div>
                    </div>
                </div>

                <div id="hasil-penilaian-container" class="animate-fade-in-up" style="display: none;">
                    <div class="flex justify-between items-center mb-6">
                        <h3 id="judul-hasil-penilaian" class="text-xl font-heading font-bold text-slate-700 border-l-4 border-indigo-500 pl-3">Hasil Penilaian</h3>
                        <button class="btn-gradient-primary text-white font-bold py-2 px-6 rounded-lg shadow-md hover:shadow-lg flex items-center gap-2" onclick="downloadLaporanNilaiPDF()">
                            <i class="fas fa-print"></i> Unduh Laporan
                        </button>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden mb-6">
                        <table class="min-w-full">
                            <thead class="bg-slate-50">
                                <tr>
                                    <th class="px-8 py-4 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">Kategori Pembiasaan</th>
                                    <th class="px-8 py-4 text-center text-xs font-bold text-slate-500 uppercase tracking-wider">Status Capaian</th>
                                </tr>
                            </thead>
                            <tbody id="body-tabel-nilai-akhir" class="divide-y divide-slate-100"></tbody>
                        </table>
                    </div>

                    <div id="deskripsi-penilaian-container" class="p-6 bg-indigo-50 rounded-2xl border border-indigo-100">
                        <h4 class="font-bold text-indigo-800 mb-3 flex items-center gap-2">
                            <i class="fas fa-comment-dots"></i> Catatan Guru:
                        </h4>
                        <p id="deskripsi-penilaian-teks" class="text-slate-700 leading-relaxed italic"></p>
                    </div>
                </div>
            </div>
            
            <!-- Halaman 6: Tutorial & Backup/Restore -->
            <div id="page-tutorial" class="page">
                <div class="flex items-center gap-3 border-b border-slate-100 pb-4 mb-6">
                    <div class="w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600">
                        <i class="fas fa-database text-xl"></i>
                    </div>
                    <h2 class="text-2xl font-heading font-bold text-slate-700">Utilitas & Bantuan</h2>
                </div>
                
                <div class="mb-8 p-6 bg-slate-50 rounded-2xl border border-slate-200">
                    <h3 class="text-lg font-bold text-slate-700 mb-2">Manajemen Data</h3>
                    <p class="text-sm text-slate-500 mb-6">Kelola data aplikasi Anda dengan aman.</p>
                    
                    <div class="flex flex-wrap gap-4">
                        <button class="btn-gradient-success text-white font-bold py-3 px-6 rounded-xl shadow-md flex items-center gap-2" onclick="backupData()">
                            <i class="fas fa-download"></i> Backup Data
                        </button>
                        
                        <input type="file" id="restore-file-input" class="hidden" accept=".json" onchange="restoreData(event)">
                        <button class="bg-amber-500 text-white font-bold py-3 px-6 rounded-xl shadow-md hover:bg-amber-600 transition-colors flex items-center gap-2" onclick="document.getElementById('restore-file-input').click()">
                            <i class="fas fa-upload"></i> Restore Data
                        </button>
                        
                        <button class="btn-gradient-danger text-white font-bold py-3 px-6 rounded-xl shadow-md flex items-center gap-2" onclick="resetAplikasi()">
                            <i class="fas fa-triangle-exclamation"></i> Reset Total
                        </button>

						<button class="bg-blue-600 text-white font-bold py-3 px-6 rounded-xl shadow-md hover:bg-blue-700 transition-colors flex items-center gap-2" onclick="unduhHalamanHTML()">
							<i class="fas fa-cloud-arrow-down"></i> Unduh App
						</button>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Tutorial Text -->
                    <div class="space-y-6 text-slate-600 leading-relaxed h-[400px] overflow-y-auto pr-2 custom-scroll">
                         <div class="bg-white p-4 rounded-xl border border-slate-100 shadow-sm">
                            <h4 class="font-bold text-indigo-600 mb-2">1. Halaman Data Sekolah</h4>
                            <p class="text-sm">Isi data sekolah sebagai kop surat laporan PDF. Tentukan target capaian dan deskripsi default.</p>
                        </div>
                        <div class="bg-white p-4 rounded-xl border border-slate-100 shadow-sm">
                            <h4 class="font-bold text-indigo-600 mb-2">2. Halaman Data Siswa</h4>
                            <p class="text-sm">Tambah siswa manual atau impor dari Excel. Pastikan Nomor Induk unik.</p>
                        </div>
                        <div class="bg-white p-4 rounded-xl border border-slate-100 shadow-sm">
                            <h4 class="font-bold text-indigo-600 mb-2">3. Halaman Input Ceklis</h4>
                            <p class="text-sm">Pilih tanggal, cari siswa, dan centang kegiatan. Klik "Simpan" untuk merekam data.</p>
                        </div>
                         <div class="bg-white p-4 rounded-xl border border-slate-100 shadow-sm">
                            <h4 class="font-bold text-indigo-600 mb-2">4. Laporan & Penilaian</h4>
                            <p class="text-sm">Unduh rekap harian atau hitung nilai akhir semester secara otomatis menjadi PDF.</p>
                        </div>
                        <div class="bg-blue-50 p-4 rounded-xl border border-blue-100">
                            <h4 class="font-bold text-blue-700 mb-2">Jurnal Harian Siswa</h4>
                            <a href="https://www.canva.com/design/DAGw5LbL_iY/o6VKbmqN6ja_JXs7BpgMPg/edit?utm_content=DAGw5LbL_iY&utm_campaign=designshare&utm_medium=link2&utm_source=sharebutton" target="_blank" class="text-blue-600 hover:text-blue-800 font-bold text-sm flex items-center gap-2">
                                <i class="fas fa-external-link-alt"></i> Unduh Template Canva Disini
                            </a>
                        </div>
                    </div>

                    <!-- Credits -->
                    <div class="flex flex-col items-center justify-center text-center p-8 bg-white rounded-3xl border border-slate-100 shadow-sm relative overflow-hidden">
                        <div class="absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-gradient-to-br from-indigo-500 to-purple-500 rounded-full opacity-20 blur-xl"></div>
                        <div class="absolute bottom-0 left-0 -mb-4 -ml-4 w-24 h-24 bg-gradient-to-tr from-blue-500 to-teal-500 rounded-full opacity-20 blur-xl"></div>
                        
                        <div class="w-16 h-16 bg-gradient-to-br from-slate-800 to-slate-900 rounded-full flex items-center justify-center text-white text-2xl mb-4 shadow-lg">
                            <i class="fas fa-code"></i>
                        </div>
                        <h4 class="font-heading font-bold text-xl text-slate-800">Bintang Adhi Permana</h4>
                        <p class="text-slate-500 text-sm mt-1">Dibuat dengan ‚ù§Ô∏è, Kopi ‚òï, dan AI ü§ñ</p>
                        
                        <a href="https://wa.me/6281310051985" target="_blank" class="mt-4 inline-flex items-center gap-2 text-green-600 font-bold hover:bg-green-50 px-4 py-2 rounded-full transition-colors">
                            <i class="fab fa-whatsapp text-xl"></i> Hubungi via WhatsApp
                        </a>

                        <div class="mt-8 pt-6 border-t border-slate-100 w-full">
                            <p class="text-sm font-semibold text-slate-600 mb-4">Dukungan Anda sangat berarti untuk pengembangan fitur.</p>
                            <div class="flex flex-col sm:flex-row justify-center items-start gap-6">
                                <!-- BNI Section -->
                                <div class="text-center group w-full sm:w-auto">
                                    <div class="w-12 h-12 mx-auto bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mb-2 group-hover:bg-orange-600 group-hover:text-white transition-all shadow-sm">
                                        <i class="fas fa-university"></i>
                                    </div>
                                    <div class="bg-orange-50 rounded-lg p-3 border border-orange-100">
                                        <p class="text-xs font-bold text-orange-800 uppercase mb-1">BNI</p>
                                        <p class="font-bold text-slate-800 text-lg select-all">0430267613</p>
                                        <p class="text-xs text-slate-500">a.n. BINTANG ADHI PERMANA</p>
                                    </div>
                                </div>
                                <!-- E-Wallet Section -->
                                <div class="text-center group w-full sm:w-auto">
                                    <div class="w-12 h-12 mx-auto bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mb-2 group-hover:bg-blue-600 group-hover:text-white transition-all shadow-sm">
                                        <i class="fas fa-wallet"></i>
                                    </div>
                                    <div class="bg-blue-50 rounded-lg p-3 border border-blue-100">
                                        <p class="text-xs font-bold text-blue-800 uppercase mb-1">Gopay / OVO / Shopee</p>
                                        <p class="font-bold text-slate-800 text-lg select-all">081310051985</p>
                                        <p class="text-xs text-slate-500">a.n. BINTANG ADHI PERMANA</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal for Login -->
    <div id="login-modal" class="modal-overlay visible">
        <div class="modal-content w-full max-w-md p-8 rounded-2xl relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-blue-500 to-indigo-600"></div>
            
            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-indigo-50 text-indigo-600 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl">
                    <i class="fas fa-lock"></i>
                </div>
                <h3 class="text-2xl font-heading font-bold text-slate-800">Selamat Datang</h3>
                <p class="text-slate-500">Silakan masukkan password untuk mengakses aplikasi.</p>
            </div>
            
            <form id="login-form">
                <div class="mb-6 relative group">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-slate-400 group-focus-within:text-indigo-500 transition-colors">
                        <i class="fas fa-key"></i>
                    </div>
                    <input type="password" id="password-input" placeholder="BANGBINANAKHEBAT" class="w-full pl-10 pr-10 p-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all" required>
                    <span class="absolute inset-y-0 right-0 flex items-center pr-3 cursor-pointer text-slate-400 hover:text-indigo-600" onclick="togglePasswordVisibility('password-input', 'eye-icon-login')">
                         <div id="eye-icon-login"><i class="fas fa-eye"></i></div>
                    </span>
                </div>
                <p id="login-error" class="text-red-500 text-sm mb-4 text-center font-medium bg-red-50 p-2 rounded-lg" style="display: none;">
                    <i class="fas fa-circle-xmark mr-1"></i> Password salah. Coba lagi.
                </p>
                <button type="submit" class="w-full btn-gradient-primary text-white font-bold py-3.5 px-4 rounded-xl shadow-lg hover:shadow-xl flex justify-center items-center gap-2">
                    Masuk Aplikasi <i class="fas fa-arrow-right"></i>
                </button>
				<br>
				<a href="https://bangbin.web.app/Aplikasi2025.html" class="w-full btn-gradient-danger text-white font-bold py-3.5 px-4 rounded-xl shadow-lg hover:shadow-xl flex justify-center items-center gap-2">
					<i class="fas fa-home"></i>
				</a>			
            </form>
            <p class="text-center text-xs text-slate-400 mt-6">Versi 2.0 - 7 Kebiasaan Anak Indonesia Hebat</p>
        </div>
    </div>

    <!-- Modal for Ceklis Input -->
    <div id="ceklis-modal" class="modal-overlay" onclick="closeCeklisModal(event)">
        <div class="modal-content w-full max-w-2xl p-0 rounded-2xl overflow-hidden shadow-2xl" onclick="event.stopPropagation()">
            <div class="bg-indigo-600 p-4 flex justify-between items-center text-white">
                <div class="flex items-center gap-3">
                    <i class="fas fa-check-circle text-2xl text-indigo-200"></i>
                    <h3 id="modal-title" class="text-xl font-bold">Input Ceklis</h3>
                </div>
                <button onclick="closeCeklisModal()" class="text-indigo-200 hover:text-white transition-colors text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div id="modal-body" class="p-6 max-h-[70vh] overflow-y-auto"></div>
            
            <div class="bg-slate-50 p-4 flex justify-end gap-3 border-t border-slate-200">
                <button onclick="closeCeklisModal()" class="px-6 py-2 rounded-xl border border-slate-300 text-slate-600 font-bold hover:bg-slate-100 transition-colors">Batal</button>
                <button id="modal-save-button" class="btn-gradient-success text-white font-bold py-2 px-8 rounded-xl shadow-md hover:shadow-lg flex items-center gap-2">
                    <i class="fas fa-save"></i> Simpan
                </button>
            </div>
        </div>
    </div>

    <!-- Modal for Excel Import -->
    <div id="import-modal" class="modal-overlay" onclick="closeImportModal(event)">
        <div class="modal-content w-full max-w-lg p-6 rounded-2xl" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-slate-700">Impor Data Siswa</h3>
                <button onclick="closeImportModal()" class="text-slate-400 hover:text-slate-700 text-xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="bg-blue-50 border border-blue-100 rounded-xl p-4 mb-6">
                <p class="text-sm text-blue-800 flex gap-2">
                    <i class="fas fa-info-circle mt-0.5"></i>
                    <span>Unggah file Excel (.xlsx) dengan kolom <strong>Induk</strong> dan <strong>Nama Siswa</strong>.</span>
                </p>
            </div>

            <div class="mb-6">
                <label for="excel-file-input" class="block w-full text-sm text-slate-500
                  file:mr-4 file:py-2.5 file:px-4
                  file:rounded-full file:border-0
                  file:text-sm file:font-semibold
                  file:bg-indigo-50 file:text-indigo-700
                  hover:file:bg-indigo-100
                  cursor-pointer
                "/>
            </div>

            <div class="flex flex-col sm:flex-row justify-between items-center gap-4 pt-4 border-t border-slate-100">
                <button onclick="downloadExcelTemplate()" class="text-sm font-bold text-slate-500 hover:text-indigo-600 flex items-center gap-1">
                    <i class="fas fa-download"></i> Unduh Template
                </button>
                <div class="flex gap-2 w-full sm:w-auto">
                    <button onclick="closeImportModal()" class="flex-1 sm:flex-none px-4 py-2 rounded-xl text-slate-600 hover:bg-slate-100 font-bold">Batal</button>
                    <button onclick="handleExcelImport()" class="flex-1 sm:flex-none btn-gradient-primary text-white font-bold py-2 px-6 rounded-xl shadow-md">Impor</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Edit Siswa -->
    <div id="edit-siswa-modal" class="modal-overlay" onclick="closeEditSiswaModal(event)">
        <div class="modal-content w-full max-w-md p-6 rounded-2xl" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center mb-6 border-b border-slate-100 pb-4">
                <h3 class="text-xl font-bold text-slate-700">Edit Data Siswa</h3>
                <button onclick="closeEditSiswaModal()" class="text-slate-400 hover:text-slate-700 text-xl"><i class="fas fa-times"></i></button>
            </div>
            <form id="form-edit-siswa" class="space-y-4">
                <input type="hidden" id="edit-siswa-id">
                <div>
                    <label for="edit-induk-siswa" class="block text-xs font-bold text-slate-500 mb-1 uppercase">No. Induk</label>
                    <input type="number" id="edit-induk-siswa" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:bg-white focus:ring-2 focus:ring-indigo-500 outline-none transition-all" required>
                </div>
                <div>
                    <label for="edit-nama-siswa" class="block text-xs font-bold text-slate-500 mb-1 uppercase">Nama Siswa</label>
                    <input type="text" id="edit-nama-siswa" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:bg-white focus:ring-2 focus:ring-indigo-500 outline-none transition-all" required>
                </div>
                <div class="flex justify-end gap-3 pt-4">
                    <button type="button" onclick="closeEditSiswaModal()" class="px-5 py-2 rounded-xl text-slate-600 font-bold hover:bg-slate-100">Batal</button>
                    <button type="submit" class="btn-gradient-primary text-white font-bold py-2 px-6 rounded-xl shadow-md">Simpan</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal for Generic Messages -->
    <div id="message-modal" class="modal-overlay">
        <div class="modal-content w-full max-w-sm p-6 rounded-2xl text-center">
            <div class="w-16 h-16 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-4 text-3xl animate-bounce-slight">
                <i class="fas fa-info"></i>
            </div>
            <h3 id="message-modal-title" class="text-xl font-bold text-slate-800 mb-2">Informasi</h3>
            <p id="message-modal-body" class="text-slate-600 mb-6 leading-relaxed"></p>
            <button onclick="closeMessageModal()" class="w-full btn-gradient-primary text-white font-bold py-2.5 rounded-xl shadow-md hover:shadow-lg">
                Mengerti
            </button>
        </div>
    </div>

    <!-- Modal for Confirmation -->
    <div id="confirm-modal" class="modal-overlay">
        <div class="modal-content w-full max-w-sm p-6 rounded-2xl text-center">
            <div class="w-16 h-16 bg-amber-100 text-amber-600 rounded-full flex items-center justify-center mx-auto mb-4 text-3xl animate-bounce-slight">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <h3 id="confirm-modal-title" class="text-xl font-bold text-slate-800 mb-2">Konfirmasi</h3>
            <p id="confirm-modal-body" class="text-slate-600 mb-6 leading-relaxed">Apakah Anda yakin ingin melanjutkan?</p>
            <div class="flex gap-3">
                 <button onclick="closeConfirmModal()" class="flex-1 px-5 py-2.5 rounded-xl border border-slate-300 text-slate-600 font-bold hover:bg-slate-50">
                    Batal
                </button>
                <button id="confirm-yes-btn" class="flex-1 btn-gradient-primary text-white font-bold py-2.5 rounded-xl shadow-md hover:shadow-lg">
                    Ya, Lanjutkan
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- GLOBAL VARIABLES & CONSTANTS ---
        const pages = document.querySelectorAll('.page');
        const navLinks = document.querySelectorAll('nav a');
        const modal = document.getElementById('ceklis-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalBody = document.getElementById('modal-body');
        const modalSaveButton = document.getElementById('modal-save-button');
        const importModal = document.getElementById('import-modal');
        const loginModal = document.getElementById('login-modal');
        const editSiswaModal = document.getElementById('edit-siswa-modal');
        
        // Modal Elements
        const messageModal = document.getElementById('message-modal');
        const messageModalTitle = document.getElementById('message-modal-title');
        const messageModalBody = document.getElementById('message-modal-body');
        
        const confirmModal = document.getElementById('confirm-modal');
        const confirmModalTitle = document.getElementById('confirm-modal-title');
        const confirmModalBody = document.getElementById('confirm-modal-body');
        const confirmYesBtn = document.getElementById('confirm-yes-btn');
        let confirmCallback = null;

        // Pagination State
        let rekapCurrentPage = 1;
        let rekapRowsPerPage = 10;

        // --- MODAL FUNCTIONS ---

        function showMessageModal(title, message) {
            messageModalTitle.textContent = title;
            messageModalBody.textContent = message;
            messageModal.classList.add('visible');
        }

        function closeMessageModal() {
            messageModal.classList.remove('visible');
        }

        function showConfirmModal(title, message, callback) {
            confirmModalTitle.textContent = title;
            confirmModalBody.textContent = message;
            confirmCallback = callback;
            confirmModal.classList.add('visible');
        }

        function closeConfirmModal() {
            confirmModal.classList.remove('visible');
            confirmCallback = null;
        }

        confirmYesBtn.onclick = () => {
            if (confirmCallback) confirmCallback();
            closeConfirmModal();
        };

        // --- NAVIGATION ---
        function showPage(pageId) {
            pages.forEach(page => page.classList.remove('active'));
            document.getElementById(`page-${pageId}`).classList.add('active');
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('onclick').includes(`'${pageId}'`)) {
                    link.classList.add('active');
                }
            });
            switch (pageId) {
                case 'siswa': renderTabelSiswa(); break;
                case 'input': renderTabelInputCeklis(); break;
                case 'rekap': 
                    populateSiswaFilter('rekap');
                    renderTabelRekap(); 
                    break;
                case 'nilai':
                    populateSiswaFilter('nilai');
                    document.getElementById('hasil-penilaian-container').style.display = 'none';
                    break;
                case 'tutorial':
                    // No specific action needed, just show the page
                    break;
            }
        }

        // --- LOCAL STORAGE HELPERS ---
        const getDb = (key) => JSON.parse(localStorage.getItem(key)) || [];
        const setDb = (key, data) => localStorage.setItem(key, JSON.stringify(data));

        // --- DYNAMIC FIELD HELPERS ---
        function getJumlahIbadah() {
            const data = JSON.parse(localStorage.getItem('dataSekolah'));
            const count = (data && data.jumlah_ibadah) ? parseInt(data.jumlah_ibadah, 10) : 5;
            return Math.max(1, Math.min(10, count));
        }

        function generateFields() {
            const jumlahIbadah = getJumlahIbadah();
            const ibadahFields = Array.from({ length: jumlahIbadah }, (_, i) => `ibadah${i + 1}`);
            const otherFields = ['bangunPagi', 'tidurCepat', 'olahRaga', 'belajar', 'bermasyarakat', 'makanBergizi'];
            return [...ibadahFields, ...otherFields];
        }

        function updateTableHeaders() {
            const jumlahIbadah = getJumlahIbadah();
            const headerRekapRow = document.getElementById('header-rekap');
            let dynamicHeaders = '';
            for (let i = 1; i <= jumlahIbadah; i++) {
                dynamicHeaders += `<th class="px-2 py-3 text-center font-bold text-slate-600 transform -rotate-45 text-xs">Ibd ${i}</th>`;
            }
            const otherHeaders = ['Pagi', 'Tidur', 'O.Raga', 'Belajar', 'Sosial', 'Gizi'];
            otherHeaders.forEach(header => {
                dynamicHeaders += `<th class="px-2 py-3 text-center font-bold text-slate-600 transform -rotate-45 text-xs">${header}</th>`;
            });
            headerRekapRow.querySelectorAll('th:nth-child(n+5)').forEach(th => th.remove());
            headerRekapRow.insertAdjacentHTML('beforeend', dynamicHeaders);
        }

        // --- PAGE: DATA SEKOLAH ---
        const formSekolah = document.getElementById('form-sekolah');
        const inputSekolah = {
            nama_sekolah: document.getElementById('nama_sekolah'),
            kelas: document.getElementById('kelas'),
            nama_guru: document.getElementById('nama_guru'),
            nip_guru: document.getElementById('nip_guru'),
            nama_kepsek: document.getElementById('nama_kepsek'),
            nip_kepsek: document.getElementById('nip_kepsek'),
            kota_sekolah: document.getElementById('kota_sekolah'), // NEW
            use_manual_date: document.getElementById('use_manual_date'), // NEW
            tanggal_cetak_manual: document.getElementById('tanggal_cetak_manual'), // NEW
            jumlah_ibadah: document.getElementById('jumlah_ibadah'),
            persen_capaian: document.getElementById('persen_capaian'),
            deskripsi_hebat: document.getElementById('deskripsi_hebat'),
            password_sekolah: document.getElementById('password_sekolah'),
            phone_sekolah: document.getElementById('phone_sekolah'),
        };

        // Event listener untuk enable/disable tanggal manual
        document.getElementById('use_manual_date').addEventListener('change', function() {
            document.getElementById('tanggal_cetak_manual').disabled = !this.checked;
        });
        
        async function sendDataToSheet() {
            const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxZBAXr5jwofR7FmZH9D3dmSesDs-e51huwwg_H2yLTLnh-ed0Gt-f9f6cWewPKsavJ/exec';
            const formData = new FormData();
            
            formData.append('nama_guru', document.getElementById('nama_guru').value);
            formData.append('nama_sekolah', document.getElementById('nama_sekolah').value);
            formData.append('password', document.getElementById('password_sekolah').value);
            formData.append('phone', document.getElementById('phone_sekolah').value);

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: formData
                });
                if (response.ok) {
                    console.log('Data successfully sent to Google Sheet.');
                } else {
                    console.error('Error sending data to Google Sheet:', response.statusText);
                    showMessageModal('Gagal', 'Gagal mengirim data ke Spreadsheet. Cek konsol untuk detail.');
                }
            } catch (error) {
                console.error('Error sending data to Google Sheet:', error);
                showMessageModal('Gagal', 'Gagal mengirim data ke Spreadsheet. Cek koneksi internet dan konsol untuk detail.');
            }
        }

        formSekolah.addEventListener('submit', (e) => {
            e.preventDefault();
            const dataSekolah = {};
            for (const key in inputSekolah) {
                if (inputSekolah[key].type === 'checkbox') {
                    dataSekolah[key] = inputSekolah[key].checked;
                } else {
                    dataSekolah[key] = inputSekolah[key].value;
                }
            }
            localStorage.setItem('dataSekolah', JSON.stringify(dataSekolah));
            
            sendDataToSheet();

            showMessageModal('Sukses', 'Data Sekolah Berhasil Disimpan!');
            updateTableHeaders();
        });

        function loadDataSekolah() {
            const data = JSON.parse(localStorage.getItem('dataSekolah'));
            if (data) {
                for (const key in data) {
                    if (inputSekolah[key]) {
                        if (inputSekolah[key].type === 'checkbox') {
                            inputSekolah[key].checked = data[key];
                        } else {
                            inputSekolah[key].value = data[key];
                        }
                    }
                }
                // Trigger event to set initial disabled state
                document.getElementById('use_manual_date').dispatchEvent(new Event('change'));
            }
        }
        
        // --- PAGE: DATA SISWA ---
        const formSiswa = document.getElementById('form-tambah-siswa');
        const indukSiswaInput = document.getElementById('induk_siswa');
        const namaSiswaInput = document.getElementById('nama_siswa');
        const bodyTabelSiswa = document.getElementById('body-tabel-siswa');
        formSiswa.addEventListener('submit', (e) => {
            e.preventDefault();
            const siswaDb = getDb('siswaDb');
            const induk = indukSiswaInput.value;
            const nama = namaSiswaInput.value.trim();
            if (siswaDb.some(siswa => siswa.induk === induk)) {
                showMessageModal('Peringatan', 'Nomor Induk sudah terdaftar.');
                return;
            }
            siswaDb.push({ id: Date.now(), induk, nama });
            setDb('siswaDb', siswaDb);
            formSiswa.reset();
            renderTabelSiswa();
            showMessageModal('Sukses', 'Siswa berhasil ditambahkan!');
        });
        function renderTabelSiswa() {
            const siswaDb = getDb('siswaDb');
            bodyTabelSiswa.innerHTML = siswaDb.map((siswa, index) => `
                <tr class="hover:bg-slate-50 transition-colors">
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">${index + 1}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900">${siswa.induk}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-700">${siswa.nama}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium">
                        <button class="text-amber-500 hover:text-amber-700 mx-2 transition-colors" onclick="openEditSiswaModal(${siswa.id})"><i class="fas fa-edit"></i></button>
                        <button class="text-red-500 hover:text-red-700 mx-2 transition-colors" onclick="hapusSiswa(${siswa.id})"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>
            `).join('');
        }
        function hapusSiswa(id) {
            showConfirmModal('Konfirmasi Hapus', 'Yakin ingin menghapus data siswa ini?', () => {
                let siswaDb = getDb('siswaDb');
                siswaDb = siswaDb.filter(s => s.id !== id);
                setDb('siswaDb', siswaDb);
                renderTabelSiswa();
            });
        }
        function openEditSiswaModal(id) {
            const siswaDb = getDb('siswaDb');
            const siswa = siswaDb.find(s => s.id === id);
            if (siswa) {
                document.getElementById('edit-siswa-id').value = siswa.id;
                document.getElementById('edit-induk-siswa').value = siswa.induk;
                document.getElementById('edit-nama-siswa').value = siswa.nama;
                editSiswaModal.classList.add('visible');
            }
        }
        function closeEditSiswaModal() {
            editSiswaModal.classList.remove('visible');
        }
        document.getElementById('form-edit-siswa').addEventListener('submit', function(e) {
            e.preventDefault();
            const id = parseInt(document.getElementById('edit-siswa-id').value);
            const induk = document.getElementById('edit-induk-siswa').value;
            const nama = document.getElementById('edit-nama-siswa').value.trim();

            let siswaDb = getDb('siswaDb');
            const isDuplicate = siswaDb.some(s => s.induk === induk && s.id !== id);

            if (isDuplicate) {
                showMessageModal('Peringatan', 'Nomor Induk sudah digunakan oleh siswa lain.');
                return;
            }

            const siswaIndex = siswaDb.findIndex(s => s.id === id);
            if (siswaIndex > -1) {
                siswaDb[siswaIndex].induk = induk;
                siswaDb[siswaIndex].nama = nama;
                setDb('siswaDb', siswaDb);
                renderTabelSiswa();
                closeEditSiswaModal();
            }
        });

        // --- PAGE: INPUT CEKLIS ---
        const bodyInputCeklis = document.getElementById('body-input-ceklis');
        const inputTanggal = document.getElementById('input-tanggal');
        const searchSiswaInput = document.getElementById('search-siswa');
        inputTanggal.valueAsDate = new Date();

        function renderTabelInputCeklis() {
            const siswaDb = getDb('siswaDb');
            const rekapDb = getDb('rekapDb');
            const tanggal = inputTanggal.value;
            const searchTerm = searchSiswaInput.value.toLowerCase();

            const filteredSiswa = siswaDb.filter(siswa => siswa.nama.toLowerCase().includes(searchTerm));

            bodyInputCeklis.innerHTML = filteredSiswa.map((siswa, index) => {
                const dataHariIni = rekapDb.find(d => d.induk === siswa.induk && d.tanggal === tanggal);
                const status = dataHariIni 
                    ? '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"><i class="fas fa-check mr-1"></i> Sudah Diisi</span>'
                    : '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800"><i class="fas fa-clock mr-1"></i> Belum Diisi</span>';
                
                return `
                    <tr class="hover:bg-indigo-50 cursor-pointer transition-colors border-b border-slate-50 last:border-none" onclick="openCeklisModal('${siswa.induk}', '${siswa.nama}')">
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">${index + 1}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900">${siswa.induk}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-indigo-600 font-semibold">${siswa.nama}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-center" id="status-${siswa.induk}">${status}</td>
                    </tr>
                `;
            }).join('');
        }
        inputTanggal.addEventListener('change', renderTabelInputCeklis);
        searchSiswaInput.addEventListener('input', renderTabelInputCeklis);

        // --- MODAL LOGIC ---
        function openCeklisModal(induk, nama) {
            const tanggal = inputTanggal.value;
            if (!tanggal) {
                showMessageModal('Peringatan', 'Pilih tanggal terlebih dahulu!');
                return;
            }
            modalTitle.textContent = `Input: ${nama}`;
            const rekapDb = getDb('rekapDb');
            const dataHariIni = rekapDb.find(d => d.induk === induk && d.tanggal === tanggal);
            const currentFields = generateFields();
            const fieldLabels = {
                bangunPagi: 'Bangun Pagi', tidurCepat: 'Tidur Cepat', olahRaga: 'Olah Raga',
                belajar: 'Belajar', bermasyarakat: 'Bermasyarakat', makanBergizi: 'Makan Bergizi'
            };
            
            const ibadahIcons = '<i class="fas fa-praying-hands text-indigo-500 mr-2"></i>';
            const defaultIcons = '<i class="fas fa-star text-amber-500 mr-2"></i>';

            let checkboxesHTML = currentFields.map(field => {
                const checked = dataHariIni && dataHariIni[field] ? 'checked' : '';
                const isIbadah = field.startsWith('ibadah');
                const labelText = isIbadah ? `Ibadah ${field.replace('ibadah', '')}` : fieldLabels[field];
                const icon = isIbadah ? ibadahIcons : defaultIcons;
                
                return `
                    <label class="flex items-center space-x-3 p-3 rounded-xl border border-slate-200 hover:bg-indigo-50 hover:border-indigo-200 transition-all cursor-pointer group">
                        <input type="checkbox" data-field="${field}" ${checked} class="individual-ceklis">
                        <span class="text-slate-700 font-medium group-hover:text-indigo-700 flex items-center">${icon} ${labelText}</span>
                    </label>
                `;
            }).join('');

            modalBody.innerHTML = `
                <div class="border-b border-slate-100 pb-4 mb-4">
                    <label class="flex items-center space-x-3 p-3 rounded-xl bg-gradient-to-r from-blue-50 to-indigo-50 border border-indigo-100 cursor-pointer shadow-sm hover:shadow-md transition-all">
                        <input type="checkbox" id="check-all-ceklis" class="form-checkbox">
                        <span class="font-bold text-indigo-700 flex items-center"><i class="fas fa-check-double mr-2"></i> PILIH SEMUA KEGIATAN</span>
                    </label>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">${checkboxesHTML}</div>
            `;

            const checkAllCheckbox = document.getElementById('check-all-ceklis');
            const allCeklisCheckboxes = modalBody.querySelectorAll('.individual-ceklis');

            const updateCheckAllState = () => {
                const allChecked = Array.from(allCeklisCheckboxes).every(cb => cb.checked);
                checkAllCheckbox.checked = allChecked;
            };

            checkAllCheckbox.addEventListener('change', (event) => {
                allCeklisCheckboxes.forEach(checkbox => {
                    checkbox.checked = event.target.checked;
                });
            });

            allCeklisCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', updateCheckAllState);
            });

            // Set initial state of "Check All"
            updateCheckAllState();

            modalSaveButton.onclick = () => saveCeklisFromModal(induk, nama, tanggal);
            modal.classList.add('visible');
        }


        function closeCeklisModal(event) {
            if (event && event.target !== modal && !modal.contains(event.target)) return;
            modal.classList.remove('visible');
        }

        function saveCeklisFromModal(induk, namaSiswa, tanggal) {
            let rekapDb = getDb('rekapDb');
            rekapDb = rekapDb.filter(d => !(d.induk === induk && d.tanggal === tanggal));
            
            const newData = { id: Date.now(), induk, namaSiswa, tanggal };
            modalBody.querySelectorAll('input[type="checkbox"][data-field]').forEach(checkbox => {
                newData[checkbox.dataset.field] = checkbox.checked;
            });
            
            rekapDb.push(newData);
            setDb('rekapDb', rekapDb);
            
            const statusCell = document.getElementById(`status-${induk}`);
            if (statusCell) {
                statusCell.innerHTML = '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"><i class="fas fa-check mr-1"></i> Sudah Diisi</span>';
            }
            
            closeCeklisModal();
        }

        // --- REKAP & NILAI PAGE ---
        const rekapSiswaFilter = document.getElementById('rekap-filter-siswa');
        const nilaiSiswaFilter = document.getElementById('nilai-filter-siswa');

        // Pagination Controls
        const rekapRowsPerPageSelect = document.getElementById('rekap-rows-per-page');
        const btnPrevPage = document.getElementById('btn-prev-page');
        const btnNextPage = document.getElementById('btn-next-page');
        const pageInfo = document.getElementById('page-info');

        rekapRowsPerPageSelect.addEventListener('change', () => {
            rekapRowsPerPage = parseInt(rekapRowsPerPageSelect.value);
            rekapCurrentPage = 1;
            renderTabelRekap();
        });

        btnPrevPage.addEventListener('click', () => {
            if (rekapCurrentPage > 1) {
                rekapCurrentPage--;
                renderTabelRekap();
            }
        });

        btnNextPage.addEventListener('click', () => {
            rekapCurrentPage++;
            renderTabelRekap();
        });

        function populateSiswaFilter(pagePrefix) {
            const filterElement = document.getElementById(`${pagePrefix}-filter-siswa`);
            if (!filterElement) return;
            const siswaDb = getDb('siswaDb');
            filterElement.innerHTML = '<option value="">Pilih Siswa...</option><option value="semua">Semua Siswa</option>';
            siswaDb.forEach(siswa => {
                const option = document.createElement('option');
                option.value = siswa.nama;
                option.textContent = siswa.nama;
                filterElement.appendChild(option);
            });
        }

        function renderTabelRekap() {
            const rekapDb = getDb('rekapDb');
            const currentFields = generateFields();
            const tanggalMulai = document.getElementById('rekap-tanggal-mulai').value;
            const tanggalAkhir = document.getElementById('rekap-tanggal-akhir').value;
            const selectedSiswa = rekapSiswaFilter.value;

            // 1. Filtering
            const filteredRekap = rekapDb.filter(data => {
                const isSiswaMatch = selectedSiswa === 'semua' || !selectedSiswa || data.namaSiswa === selectedSiswa;
                const isTanggalMatch = (!tanggalMulai || data.tanggal >= tanggalMulai) && (!tanggalAkhir || data.tanggal <= tanggalAkhir);
                return isSiswaMatch && isTanggalMatch;
            });

            filteredRekap.sort((a, b) => (b.tanggal + a.namaSiswa).localeCompare(a.tanggal + b.namaSiswa));
            
            // 2. Pagination Logic
            const totalRows = filteredRekap.length;
            const totalPages = Math.ceil(totalRows / rekapRowsPerPage) || 1;
            
            // Ensure current page is valid
            if (rekapCurrentPage > totalPages) rekapCurrentPage = totalPages;
            if (rekapCurrentPage < 1) rekapCurrentPage = 1;

            const startIndex = (rekapCurrentPage - 1) * rekapRowsPerPage;
            const endIndex = startIndex + rekapRowsPerPage;
            const paginatedData = filteredRekap.slice(startIndex, endIndex);

            // 3. Update Controls
            pageInfo.textContent = `Hal ${rekapCurrentPage} dari ${totalPages}`;
            btnPrevPage.disabled = rekapCurrentPage === 1;
            btnNextPage.disabled = rekapCurrentPage === totalPages;

            // 4. Render Table
            document.getElementById('body-tabel-rekap').innerHTML = paginatedData.map((data, index) => {
                const realIndex = startIndex + index + 1; // Correct index for pagination
                const ceklisCells = currentFields.map(field => 
                    `<td class="p-2 text-center border-l border-slate-50">${data[field] ? '<i class="fas fa-check text-green-500"></i>' : '<i class="fas fa-times text-red-300 text-xs"></i>'}</td>`
                ).join('');
                return `
                    <tr class="hover:bg-slate-50 border-b border-slate-50">
                        <td class="px-4 py-2 text-center sticky left-0 bg-white z-10 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.05)] text-slate-500 text-xs">${realIndex}</td>
                        <td class="px-4 py-2 text-center sticky left-10 bg-white z-10 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.05)] text-xs font-medium">${data.induk}</td>
                        <td class="px-6 py-2 sticky left-24 bg-white z-10 w-48 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.05)] text-xs font-semibold text-indigo-700">${data.namaSiswa}</td>
                        <td class="px-4 py-2 text-center text-xs text-slate-500 whitespace-nowrap">${data.tanggal}</td>
                        ${ceklisCells}
                    </tr>
                `;
            }).join('');
        }

        function hapusSemuaDataRekap() {
             showConfirmModal('Konfirmasi Hapus', 'PERINGATAN! Anda akan menghapus SEMUA data rekap. Aksi ini tidak dapat dibatalkan. Lanjutkan?', () => {
                setDb('rekapDb', []);
                rekapCurrentPage = 1;
                renderTabelRekap();
                showMessageModal('Sukses', 'Semua data rekap telah dihapus.');
            });
        }
        
        // --- PAGE: NILAI ---
        function tampilkanPenilaian() {
            const selectedSiswa = document.getElementById('nilai-filter-siswa').value;
            const tanggalMulai = document.getElementById('nilai-tanggal-mulai').value;
            const tanggalAkhir = document.getElementById('nilai-tanggal-akhir').value;

            if (!selectedSiswa || !tanggalMulai || !tanggalAkhir) {
                showMessageModal('Peringatan', 'Silakan pilih siswa dan tentukan rentang tanggal mulai dan akhir.');
                return;
            }
            if (selectedSiswa === 'semua') {
                showMessageModal('Informasi', 'Fitur penilaian akhir hanya untuk perorangan. Silakan pilih satu siswa.');
                return;
            }

            const rekapDb = getDb('rekapDb');
            const filteredData = rekapDb.filter(data => 
                data.namaSiswa === selectedSiswa && 
                data.tanggal >= tanggalMulai && 
                data.tanggal <= tanggalAkhir
            );

            if (filteredData.length === 0) {
                showMessageModal('Informasi', 'Tidak ditemukan data untuk siswa dan rentang tanggal yang dipilih.');
                document.getElementById('hasil-penilaian-container').style.display = 'none';
                return;
            }

            const sekolahData = JSON.parse(localStorage.getItem('dataSekolah')) || {};
            const persenCapaian = parseInt(sekolahData.persen_capaian, 10) || 70;

            const totalHari = filteredData.length;
            const capaian = {
                ibadah: 0, bangunPagi: 0, tidurCepat: 0, olahRaga: 0,
                belajar: 0, bermasyarakat: 0, makanBergizi: 0
            };

            const jumlahIbadah = getJumlahIbadah();
            filteredData.forEach(data => {
                let semuaIbadah = true;
                for(let i = 1; i <= jumlahIbadah; i++) {
                    if (!data[`ibadah${i}`]) {
                        semuaIbadah = false;
                        break;
                    }
                }
                if (semuaIbadah) capaian.ibadah++;
                if (data.bangunPagi) capaian.bangunPagi++;
                if (data.tidurCepat) capaian.tidurCepat++;
                if (data.olahRaga) capaian.olahRaga++;
                if (data.belajar) capaian.belajar++;
                if (data.bermasyarakat) capaian.bermasyarakat++;
                if (data.makanBergizi) capaian.makanBergizi++;
            });

            const hasilAkhir = {
                'Ibadah': (capaian.ibadah / totalHari) * 100 >= persenCapaian ? 'Terbiasa' : 'Perlu Bimbingan',
                'Bangun Pagi': (capaian.bangunPagi / totalHari) * 100 >= persenCapaian ? 'Terbiasa' : 'Perlu Bimbingan',
                'Tidur Cepat': (capaian.tidurCepat / totalHari) * 100 >= persenCapaian ? 'Terbiasa' : 'Perlu Bimbingan',
                'Olah Raga': (capaian.olahRaga / totalHari) * 100 >= persenCapaian ? 'Terbiasa' : 'Perlu Bimbingan',
                'Belajar': (capaian.belajar / totalHari) * 100 >= persenCapaian ? 'Terbiasa' : 'Perlu Bimbingan',
                'Bermasyarakat': (capaian.bermasyarakat / totalHari) * 100 >= persenCapaian ? 'Terbiasa' : 'Perlu Bimbingan',
                'Makan Bergizi': (capaian.makanBergizi / totalHari) * 100 >= persenCapaian ? 'Terbiasa' : 'Perlu Bimbingan',
            };

            const bodyTabel = document.getElementById('body-tabel-nilai-akhir');
            bodyTabel.innerHTML = '';
            const terbiasaList = [];
            const perluBimbinganList = [];

            for (const kategori in hasilAkhir) {
                const predikat = hasilAkhir[kategori];
                if (predikat === 'Terbiasa') {
                    terbiasaList.push(kategori.toLowerCase());
                } else {
                    perluBimbinganList.push(kategori.toLowerCase());
                }
                const badgeClass = predikat === 'Terbiasa' 
                    ? 'bg-green-100 text-green-700 border-green-200' 
                    : 'bg-orange-100 text-orange-700 border-orange-200';
                
                const icon = predikat === 'Terbiasa' ? '<i class="fas fa-check-circle mr-1"></i>' : '<i class="fas fa-exclamation-circle mr-1"></i>';

                const row = `
                    <tr class="hover:bg-slate-50 transition-colors">
                        <td class="px-8 py-4 font-medium text-slate-800 border-b border-slate-100">${kategori}</td>
                        <td class="px-8 py-4 text-center border-b border-slate-100">
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold border ${badgeClass}">
                                ${icon} ${predikat}
                            </span>
                        </td>
                    </tr>
                `;
                bodyTabel.innerHTML += row;
            }

            // Generate Description
            const deskripsiTeks = document.getElementById('deskripsi-penilaian-teks');
            const formatList = (arr) => {
                if (arr.length === 0) return '';
                if (arr.length === 1) return arr[0];
                return arr.slice(0, -1).join(', ') + ', dan ' + arr.slice(-1);
            };

            if (perluBimbinganList.length === 0) {
                deskripsiTeks.textContent = sekolahData.deskripsi_hebat || `Ananda ${selectedSiswa}, adalah anak Indonesia Hebat.`;
                deskripsiTeks.textContent = deskripsiTeks.textContent.replace('namaSiswa', selectedSiswa);
            } else {
                let deskripsi = `Ananda ${selectedSiswa} `;
                if (terbiasaList.length > 0) {
                    deskripsi += `sudah terbiasa ${formatList(terbiasaList)}, namun untuk menjadi anak hebat, ananda perlu konsisten dalam ${formatList(perluBimbinganList)}.`;
                } else {
                    deskripsi += `perlu konsisten dalam ${formatList(perluBimbinganList)} untuk menjadi anak hebat.`;
                }
                deskripsiTeks.textContent = deskripsi;
            }

            document.getElementById('judul-hasil-penilaian').textContent = `Laporan Capaian: ${selectedSiswa}`;
            document.getElementById('hasil-penilaian-container').style.display = 'block';
        }

        // --- PDF EXPORT ---
        function downloadRekapPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('l', 'pt', 'a4');
            const sekolahData = JSON.parse(localStorage.getItem('dataSekolah')) || {};
            const rekapDb = getDb('rekapDb');
            const currentFields = generateFields();
            const tanggalMulai = document.getElementById('rekap-tanggal-mulai').value;
            const tanggalAkhir = document.getElementById('rekap-tanggal-akhir').value;
            const selectedSiswa = rekapSiswaFilter.value;

            const filteredRekap = rekapDb.filter(data => {
                const isSiswaMatch = selectedSiswa === 'semua' || data.namaSiswa === selectedSiswa;
                const isTanggalMatch = (!tanggalMulai || data.tanggal >= tanggalMulai) && (!tanggalAkhir || data.tanggal <= tanggalAkhir);
                return isSiswaMatch && isTanggalMatch;
            });

            if (filteredRekap.length === 0) {
                showMessageModal('Informasi', 'Tidak ada data rekap untuk diunduh.');
                return;
            }
            filteredRekap.sort((a, b) => (a.namaSiswa + a.tanggal).localeCompare(b.namaSiswa + b.tanggal));

            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.text('REKAPITULASI 7 KEBIASAAN ANAK INDONESIA HEBAT', doc.internal.pageSize.getWidth() / 2, 40, { align: 'center' });
            
            doc.setFontSize(11);
            doc.setFont('helvetica', 'normal');

            const labelX = 40;
            const valueX = 150; 

            doc.text('NAMA SEKOLAH', labelX, 70);
            doc.text(`: ${sekolahData.nama_sekolah || ''}`, valueX, 70);

            doc.text('KELAS', labelX, 85);
            doc.text(`: ${sekolahData.kelas || ''}`, valueX, 85);
            
            let startY = 85; 
            if (selectedSiswa !== 'semua') {
                startY += 15;
                doc.text('NAMA SISWA', labelX, startY);
                doc.text(`: ${selectedSiswa}`, valueX, startY);
            }

            let tanggalRekap = "Seluruh Data";
            if (tanggalMulai && tanggalAkhir) tanggalRekap = `${tanggalMulai} s/d ${tanggalAkhir}`;
            else if (tanggalMulai) tanggalRekap = `Mulai ${tanggalMulai}`;
            else if (tanggalAkhir) tanggalRekap = `Sampai ${tanggalAkhir}`;
            
            startY += 15;
            doc.text('PERIODE', labelX, startY);
            doc.text(`: ${tanggalRekap}`, valueX, startY);

            const ibadahHeaders = Array.from({ length: getJumlahIbadah() }, (_, i) => `I${i + 1}`);
            const otherHeaders = ['BP', 'TC', 'OR', 'B', 'BM', 'MB'];
            const allCheckHeaders = [...ibadahHeaders, ...otherHeaders];
            
            let head, body;
            if (selectedSiswa === 'semua') {
                head = [['No', 'Induk', 'Nama Siswa', ...allCheckHeaders]];
                body = filteredRekap.map((data, index) => {
                    const row = [ index + 1, data.induk, data.namaSiswa ];
                    currentFields.forEach(field => row.push(data[field] ? 'V' : ''));
                    return row;
                });
            } else {
                head = [['No', 'Tanggal', ...allCheckHeaders]];
                body = filteredRekap.map((data, index) => {
                    const row = [ index + 1, data.tanggal ];
                    currentFields.forEach(field => row.push(data[field] ? 'V' : ''));
                    return row;
                });
            }

            doc.autoTable({
                head: head, body: body, startY: startY + 25, theme: 'grid', 
                headStyles: { fillColor: [79, 70, 229], halign: 'center' }, // Indigo-600
                styles: { fontSize: 8, cellPadding: 3, halign: 'center' },
                columnStyles: { 2: { halign: 'left', cellWidth: selectedSiswa === 'semua' ? 150 : 'auto' } }
            });

            const finalY = doc.lastAutoTable.finalY + 40;
            const pageWidth = doc.internal.pageSize.getWidth();
            
            // --- LOGIKA TANGGAL CETAK & KOTA ---
            const kota = sekolahData.kota_sekolah || 'Jakarta';
            let tanggalStr = '';
            
            if (sekolahData.use_manual_date && sekolahData.tanggal_cetak_manual) {
                // Parse tanggal manual
                const dateObj = new Date(sekolahData.tanggal_cetak_manual);
                tanggalStr = dateObj.toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });
            } else {
                // Gunakan tanggal komputer
                tanggalStr = new Date().toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });
            }
            // --- AKHIR LOGIKA ---

            doc.setFontSize(10);
            doc.text(`${kota}, ${tanggalStr}`, pageWidth - 40, finalY, { align: 'right' });
            
            doc.text('Kepala Sekolah', 40, finalY + 20);
            doc.text(sekolahData.nama_kepsek || '(Nama Kepsek)', 40, finalY + 80);
            doc.text(`NIP: ${sekolahData.nip_kepsek || '(NIP Kepsek)'}`, 40, finalY + 95);
            doc.text('Guru Kelas', pageWidth - 40, finalY + 20, { align: 'right' });
            doc.text(sekolahData.nama_guru || '(Nama Guru)', pageWidth - 40, finalY + 80, { align: 'right' });
            doc.text(`NIP: ${sekolahData.nip_guru || '(NIP Guru)'}`, pageWidth - 40, finalY + 95, { align: 'right' });
            
            doc.save(`rekap_ceklis_${selectedSiswa === 'semua' ? 'semua_siswa' : selectedSiswa.replace(' ','_')}_${new Date().toISOString().slice(0,10)}.pdf`);
        }
        
        function downloadLaporanNilaiPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'pt', 'a4');
            const sekolahData = JSON.parse(localStorage.getItem('dataSekolah')) || {};
            const selectedSiswa = document.getElementById('nilai-filter-siswa').value;
            const tanggalMulai = document.getElementById('nilai-tanggal-mulai').value;
            const tanggalAkhir = document.getElementById('nilai-tanggal-akhir').value;
            const deskripsiTeks = document.getElementById('deskripsi-penilaian-teks').textContent;

            if (!selectedSiswa || selectedSiswa === 'semua' || !document.getElementById('body-tabel-nilai-akhir').innerHTML) {
                showMessageModal('Peringatan', 'Tampilkan penilaian untuk satu siswa terlebih dahulu sebelum mengunduh.');
                return;
            }

            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.text('CAPAIAN PEMBIASAAN 7 KEBIASAAN ANAK INDONESIA HEBAT', doc.internal.pageSize.getWidth() / 2, 40, { align: 'center' });
            
            doc.setFontSize(11);
            doc.setFont('helvetica', 'normal');

            const labelX = 40;
            const valueX = 150; 

            doc.text('NAMA SEKOLAH', labelX, 70);
            doc.text(`: ${sekolahData.nama_sekolah || ''}`, valueX, 70);

            doc.text('KELAS', labelX, 85);
            doc.text(`: ${sekolahData.kelas || ''}`, valueX, 85);

            doc.text('NAMA SISWA', labelX, 100);
            doc.text(`: ${selectedSiswa}`, valueX, 100);

            doc.text('PERIODE', labelX, 115);
            doc.text(`: ${tanggalMulai} s/d ${tanggalAkhir}`, valueX, 115);

            const head = [['Kategori', 'Capaian']];
            const body = [];
            document.querySelectorAll('#body-tabel-nilai-akhir tr').forEach(tr => {
                const kategori = tr.cells[0].textContent;
                const capaian = tr.cells[1].textContent.trim(); // Trim extra whitespace from HTML
                body.push([kategori, capaian]);
            });

            doc.autoTable({
                head: head, body: body, startY: 140, theme: 'grid',
                headStyles: { fillColor: [79, 70, 229], halign: 'center' }, // Indigo-600
                styles: { fontSize: 10, cellPadding: 5 },
                columnStyles: { 0: { halign: 'left' }, 1: { halign: 'center' } }
            });

            let finalY = doc.lastAutoTable.finalY + 20;
            
            doc.setFontSize(10);
            doc.setFont('helvetica', 'bold');
            doc.text('Deskripsi Capaian:', 40, finalY);
            finalY += 15;

            doc.setFont('helvetica', 'normal');
            const splitDeskripsi = doc.splitTextToSize(deskripsiTeks, doc.internal.pageSize.getWidth() - 80);
            doc.text(splitDeskripsi, 40, finalY);
            finalY += (splitDeskripsi.length * 12) + 20;

            const pageWidth = doc.internal.pageSize.getWidth();
            
            // --- LOGIKA TANGGAL CETAK & KOTA ---
            const kota = sekolahData.kota_sekolah || 'Jakarta';
            let tanggalStr = '';
            
            if (sekolahData.use_manual_date && sekolahData.tanggal_cetak_manual) {
                // Parse tanggal manual
                const dateObj = new Date(sekolahData.tanggal_cetak_manual);
                tanggalStr = dateObj.toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });
            } else {
                // Gunakan tanggal komputer
                tanggalStr = new Date().toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });
            }
            // --- AKHIR LOGIKA ---

            doc.setFontSize(10);
            const centerLeft = pageWidth * 0.25;
            const centerRight = pageWidth * 0.75;

            if (typeof kota !== 'undefined' && typeof tanggalStr !== 'undefined') {
                doc.text(`${kota}, ${tanggalStr}`, centerRight, finalY, { align: 'center' });
            }

            doc.text('Kepala Sekolah', centerLeft, finalY + 20, { align: 'center' });
            doc.text(sekolahData.nama_kepsek || '(Nama Kepsek)', centerLeft, finalY + 80, { align: 'center' });
            doc.text(`NIP: ${sekolahData.nip_kepsek || '(NIP Kepsek)'}`, centerLeft, finalY + 95, { align: 'center' });

            doc.text('Guru Kelas', centerRight, finalY + 20, { align: 'center' });
            doc.text(sekolahData.nama_guru || '(Nama Guru)', centerRight, finalY + 80, { align: 'center' });
            doc.text(`NIP: ${sekolahData.nip_guru || '(NIP Guru)'}`, centerRight, finalY + 95, { align: 'center' });
            
            doc.save(`laporan_nilai_${selectedSiswa.replace(' ','_')}_${new Date().toISOString().slice(0,10)}.pdf`);
        }
        
        // --- EXCEL IMPORT/EXPORT ---
        function openImportModal() {
            importModal.classList.add('visible');
        }
        function closeImportModal(event) {
            if (event && event.target !== importModal && !importModal.contains(event.target)) return;
            importModal.classList.remove('visible');
        }
        function downloadExcelTemplate() {
            const defaultSiswa = getDb('siswaDb').map(s => ({ Induk: s.induk, 'Nama Siswa': s.nama }));
            const worksheet = XLSX.utils.json_to_sheet(defaultSiswa);
            worksheet['!cols'] = [{wch:15}, {wch:40}];
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, 'Bangbin Siswa');
            XLSX.writeFile(workbook, 'bangbin_siswa.xlsx');
        }
        function handleExcelImport() {
            const input = document.getElementById('excel-file-input');
            if (!input.files.length) {
                showMessageModal('Peringatan', 'Silakan pilih file Excel terlebih dahulu!');
                return;
            }
            const file = input.files[0];
            const reader = new FileReader();
            reader.onload = function(event) {
                const data = new Uint8Array(event.target.result);
                const workbook = XLSX.read(data, {type: 'array'});
                const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                const jsonData = XLSX.utils.sheet_to_json(firstSheet, {header: ['Induk', 'Nama Siswa'], range: 1});

                let siswaDb = getDb('siswaDb');
                const existingInduk = new Set(siswaDb.map(s => String(s.induk)));
                let addedCount = 0;
                let skippedCount = 0;
                
                jsonData.forEach(item => {
                    const induk = String(item.Induk).trim();
                    const nama = String(item['Nama Siswa']).trim();
                    if (induk && nama && !existingInduk.has(induk)) {
                        siswaDb.push({ id: Date.now() + Math.random(), induk, nama });
                        existingInduk.add(induk);
                        addedCount++;
                    } else {
                        skippedCount++;
                    }
                });

                setDb('siswaDb', siswaDb);
                renderTabelSiswa();
                closeImportModal();
                showMessageModal('Sukses', `${addedCount} siswa berhasil diimpor. ${skippedCount} siswa dilewati.`);
                input.value = '';
            };
            reader.readAsArrayBuffer(file);
        }

        // --- BACKUP & RESTORE ---
        function backupData() {
            const dataToBackup = {
                dataSekolah: JSON.parse(localStorage.getItem('dataSekolah')),
                siswaDb: getDb('siswaDb'),
                rekapDb: getDb('rekapDb')
            };

            const jsonString = JSON.stringify(dataToBackup, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            const today = new Date().toISOString().slice(0, 10);
            a.download = `backup_ceklis_siswa_${today}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function restoreData(event) {
            const file = event.target.files[0];
            if (!file) {
                return;
            }

            showConfirmModal('Konfirmasi Restore', 'PERINGATAN! Merestore data akan menimpa semua data yang ada saat ini. Lanjutkan?', () => {
                 const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const restoredData = JSON.parse(e.target.result);
                        if (restoredData.dataSekolah && restoredData.siswaDb && restoredData.rekapDb) {
                            localStorage.setItem('dataSekolah', JSON.stringify(restoredData.dataSekolah));
                            setDb('siswaDb', restoredData.siswaDb);
                            setDb('rekapDb', restoredData.rekapDb);
                            showMessageModal('Sukses', 'Data berhasil direstore! Aplikasi akan dimuat ulang.');
                            setTimeout(() => location.reload(), 1500); 
                        } else {
                            showMessageModal('Gagal', 'File backup tidak valid.');
                        }
                    } catch (error) {
                        showMessageModal('Gagal', 'Gagal membaca file backup.');
                        console.error("Restore error:", error);
                    } finally {
                        event.target.value = '';
                    }
                };
                reader.readAsText(file);
            });
            // If user cancels confirm modal, clear input immediately
            if (!confirmCallback) {
                 event.target.value = '';
            }
        }

        function resetAplikasi() {
            showConfirmModal('Konfirmasi Reset', 'PERINGATAN! Reset akan menghapus seluruh data. Lanjutkan?', () => {
                localStorage.clear();
                showMessageModal('Sukses', 'Aplikasi berhasil direset. Muat ulang...');
                setTimeout(() => location.reload(), 1500);
            });
        }

        // --- DEFAULT DATA LOADER ---
        function loadDefaultData() {
            if (!localStorage.getItem('dataSekolah')) {
                const defaultSekolah = {
                    nama_sekolah: "SDN Lubang Buaya 01", kelas: "V (lima)", nama_guru: "Bintang Adhi Permana",
                    nip_guru: "081310051985", nama_kepsek: "Dr.Bangbin, Edd", nip_kepsek: "6281310051985",
                    kota_sekolah: "Jakarta",
                    use_manual_date: false,
                    tanggal_cetak_manual: "",
                    jumlah_ibadah: 5,
                    persen_capaian: 70,
                    deskripsi_hebat: "Ananda namaSiswa, adalah anak Indonesia Hebat",
                    password_sekolah: "BANGBINANAKHEBAT",
                    phone_sekolah: ""
                };
                localStorage.setItem('dataSekolah', JSON.stringify(defaultSekolah));
            }
            if (getDb('siswaDb').length === 0) {
                const defaultSiswa = [
                    { id: Date.now() + 1, induk: '1001', nama: 'Rizal Mahardika' }, { id: Date.now() + 2, induk: '1002', nama: 'Didik Rahmadi' },
                    { id: Date.now() + 3, induk: '1003', nama: 'Muslim Mackbook' }, { id: Date.now() + 4, induk: '1004', nama: 'Ika Nirmala' },
                    { id: Date.now() + 5, induk: '1005', nama: 'Dhoy Edu' }, { id: Date.now() + 6, induk: '1006', nama: 'I Wayan Yogi' }, { id: Date.now() + 7, induk: '1007', nama: 'Asmaul Husnah' }, { id: Date.now() + 8, induk: '1008', nama: 'Iskak Wiyono' }, { id: Date.now() + 9, induk: '1009', nama: 'Yusuf Uhuuy' }, { id: Date.now() + 10, induk: '1010', nama: 'Momol' }, { id: Date.now() + 11, induk: '1011', nama: 'Oriza Uhuuy' },  { id: Date.now() + 12, induk: '1012', nama: 'Channy Cahnel' }, { id: Date.now() + 13, induk: '1013', nama: 'Tisna' }
                ];
                setDb('siswaDb', defaultSiswa);
            }
        }

        // --- LOGIN LOGIC ---
        function handleLogin(event) {
            event.preventDefault();
            const passwordInput = document.getElementById('password-input').value;
            const dataSekolah = JSON.parse(localStorage.getItem('dataSekolah')) || {};
            const correctPassword = dataSekolah.password_sekolah || "BANGBINANAKHEBAT";

            if (passwordInput === correctPassword) {
                // Save login state
                localStorage.setItem('isLoggedIn', 'true');
                
                loginModal.classList.remove('visible');
                setTimeout(() => {
                    document.getElementById('app-container').style.display = 'block';
                    loadDataSekolah();
                    updateTableHeaders();
                    showPage('sekolah');
                }, 300);
            } else {
                const loginContent = loginModal.querySelector('.modal-content');
                loginContent.style.animation = 'shake 0.5s';
                setTimeout(() => {
                    loginContent.style.animation = '';
                }, 500);
                document.getElementById('login-error').style.display = 'block';
            }
        }

        // --- LOGOUT LOGIC ---
        function handleLogout() {
            showConfirmModal('Konfirmasi Keluar', 'Apakah Anda yakin ingin keluar dari aplikasi?', () => {
                localStorage.removeItem('isLoggedIn');
                location.reload();
            });
        }
        
        // --- UTILITY FUNCTIONS ---
        function togglePasswordVisibility(inputId, iconId) {
            const passwordInput = document.getElementById(inputId);
            const icon = document.getElementById(iconId);
            if (passwordInput.type === "password") {
                passwordInput.type = "text";
                icon.innerHTML = '<i class="fas fa-eye-slash"></i>';
            } else {
                passwordInput.type = "password";
                icon.innerHTML = '<i class="fas fa-eye"></i>';
            }
        }

        // --- INITIALIZE APP ---
        document.addEventListener('DOMContentLoaded', () => {
            loadDefaultData();
            
            // Check Login Status
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            if (isLoggedIn) {
                document.getElementById('login-modal').classList.remove('visible');
                document.getElementById('app-container').style.display = 'block';
                loadDataSekolah();
                updateTableHeaders();
                showPage('sekolah');
            }

            document.getElementById('login-form').addEventListener('submit', handleLogin);

            // Add event listeners for filters
            document.getElementById('rekap-tanggal-mulai').addEventListener('change', renderTabelRekap);
            document.getElementById('rekap-tanggal-akhir').addEventListener('change', renderTabelRekap);
            rekapSiswaFilter.addEventListener('change', renderTabelRekap);
        });
    </script>

	<script>
	function unduhHalamanHTML() {
	  // Menentukan tipe konten dan mengambil seluruh HTML dari halaman saat ini
	  const tipeKonten = 'text/html';
	  const kontenHTML = document.documentElement.outerHTML;

	  // Membuat "Blob", yaitu objek seperti file dari konten HTML
	  const blob = new Blob([kontenHTML], { type: tipeKonten });
	  const url = URL.createObjectURL(blob);

	  // Membuat elemen link (<a>) sementara di memori
	  const tautanUnduh = document.createElement('a');
	  tautanUnduh.href = url;
	  
	  // Menentukan nama file default saat diunduh, menggunakan judul halaman
	  const namaFile = (document.title || 'Aplikasi_7KAIH_Modern') + '.html';
	  tautanUnduh.download = namaFile;

	  // Secara otomatis mengklik link untuk memulai unduhan
	  document.body.appendChild(tautanUnduh);
	  tautanUnduh.click();
	  
	  // Membersihkan elemen dan URL sementara yang dibuat
	  document.body.removeChild(tautanUnduh);
	  URL.revokeObjectURL(url);
	}
	</script>

</body>
</html>
