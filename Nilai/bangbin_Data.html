<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Informasi Sekolah & Rapor</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="icon" type="image/x-icon" href="https://lh3.googleusercontent.com/d/16rll5zsRdwTbR3nF_NmPKwY51tg4tnOn">
    <link rel="stylesheet" href="style.css">
    <style>
        /* === CSS Desain Minimalis === */
        body { background: var(--bg-color); }
        .container {
            /* INSTRUKSI: Membuat halaman selebar layar (Full Width) */
            width: 98%;
            max-width: 100%; /* Override batasan 950px dari style.css */
            background-color: #ffffff;
            box-shadow: 0 8px 40px rgba(0, 0, 0, 0.08); border-radius: 16px;
            padding: 30px 40px; margin-top: 20px; border: 1px solid var(--border-color);
        }
        .page-header {
            display: flex; align-items: center; gap: 20px;
            margin-bottom: 25px; padding-bottom: 20px; border-bottom: 1px solid var(--border-color);
        }
        .page-header h1 { margin: 0; padding: 0; border: none; font-size: 1.8em; color: var(--text-color); }
        .home-link { display: inline-flex; color: var(--text-color); transition: color 0.2s; }
        .home-link:hover { color: var(--primary-color); }
        .home-link i { font-size: 1.8em; }
        .form-section-title {
            font-size: 1.2em; font-weight: 600; color: var(--secondary-color);
            margin-top: 20px; margin-bottom: 20px;
            grid-column: 1 / -1; display: flex; align-items: center; gap: 10px;
        }
        .form-section-title:first-child { margin-top: 0; }
        .form-section-title .line { flex-grow: 1; height: 1px; background-color: var(--border-color); }
        .input-group { position: relative; display: flex; align-items: center; }
        .input-group .icon {
            position: absolute; left: 15px; color: #aaa;
            font-size: 0.9em; transition: color 0.2s; pointer-events: none;
        }
        .input-group input, .input-group select { padding-left: 40px !important; }
        .input-group input:focus + .icon, .input-group select:focus + .icon { color: var(--primary-color); }
        .form-grid { display: grid; gap: 18px 40px; grid-template-columns: repeat(2, 1fr); }
        .submit-container {
            display: flex; justify-content: flex-end; align-items: center; gap: 15px;
            margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--border-color);
        }
        .submit-container button {
            font-size: 1em; padding: 12px 30px;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            box-shadow: 0 4px 20px rgba(74,144,226,0.4);
        }
        .submit-container button i { margin-right: 8px; }
        
        /* === CSS BARU UNTUK UPLOAD LOGO === */
        .logo-uploader {
            grid-column: 1 / -1; /* Mengambil lebar penuh */
            display: flex;
            align-items: center;
            gap: 30px;
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            border: 1px dashed var(--border-color);
        }
        .logo-preview {
            width: 100px;
            height: 100px;
            border-radius: 50%; /* Membuat frame menjadi lingkaran */
            border: 3px solid #fff;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #e9ecef;
            flex-shrink: 0;
        }
        .logo-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Memastikan logo mengisi frame tanpa distorsi */
        }
        .logo-instructions p { margin: 0 0 10px 0; font-size: 0.9em; color: #6c757d; }
        .logo-actions { display: flex; gap: 10px; }
        .logo-actions label, .logo-actions button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            font-size: 0.9em;
            border-radius: 8px;
            cursor: pointer;
            border: 1px solid var(--border-color);
            background-color: #fff;
            color: var(--text-color);
            transition: all 0.2s ease;
        }
        .logo-actions label:hover, .logo-actions button:hover {
             border-color: var(--primary-color);
             background-color: var(--primary-color);
             color: #fff;
        }
        .logo-actions button { background-color: #f1f1f1; border-color: #ddd; }
        .logo-actions button:hover { background-color: var(--danger-color); border-color: var(--danger-color); color: #fff;}
        #logoUploadInput { display: none; } /* Sembunyikan input file asli */
        
        /* Styling Modal sesuai kebutuhan uhuuyy.js */
        #actionConfirmModal { display: none; }
        #actionConfirmModal.show { display: flex !important; }
        .modal-icon { font-size: 3rem; margin-bottom: 15px; display: block; }
        .modal-icon.success { color: var(--success-color); }
        .modal-icon.error { color: var(--danger-color); }
        .modal-icon.warning { color: #f39c12; }
        
        @media (max-width: 768px) {
            .form-grid { grid-template-columns: 1fr; }
            .logo-uploader { flex-direction: column; text-align: center; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="page-header">
             <a href="bangbin_Rapor.html" class="home-link" title="Kembali ke Menu Utama">
                <i class="fa-solid fa-circle-chevron-left"></i>
            </a>
            <h1>Pengaturan Informasi Sekolah</h1>
        </header>

        <form id="formInfoDasar">
            <div class="form-grid">

                <div class="logo-uploader">
                    <div class="logo-preview">
                        <img id="logoPreview" src="https://via.placeholder.com/100" alt="Logo Sekolah">
                    </div>
                    <div class="logo-instructions">
                        <h4>Logo Sekolah</h4>
                        <p>Unggah logo sekolah Anda. Format yang disarankan adalah JPG, PNG, atau SVG dengan rasio 1:1 (persegi).</p>
                        <div class="logo-actions">
                            <label for="logoUploadInput"><i class="fa-solid fa-arrow-up-from-bracket"></i> Pilih File</label>
                            <input type="file" id="logoUploadInput" accept="image/*">
                            <button type="button" id="removeLogoButton"><i class="fa-solid fa-trash"></i> Hapus Logo</button>
                        </div>
                    </div>
                </div>

                <div class="form-section-title">
                    <span>Identitas Sekolah</span><div class="line"></div>
                </div>
                <div><label for="namaSekolah">Nama Sekolah</label><div class="input-group"><input type="text" id="namaSekolah" placeholder="Nama lengkap sekolah..." required><i class="icon fa-solid fa-school"></i></div></div>
                <div><label for="npsn">NPSN</label><div class="input-group"><input type="number" id="npsn" placeholder="8 digit NPSN..."><i class="icon fa-solid fa-hashtag"></i></div></div>
                <div><label for="jenjang">Jenjang Pendidikan</label><div class="input-group"><select id="jenjang"><option>Sekolah Dasar</option><option>Sekolah Dasar Islam Terpadu</option><option>Sekolah Dasar Kristen</option><option>Sekolah Menengah Pertama</option><option>Sekolah Menengah Pertama Islam Terpadu</option><option>Sekolah Menengah Atas</option><option>Sekolah Menengah Atas Islam Terpadu</option><option>Sekolah Menengah Kejuruan</option></select><i class="icon fa-solid fa-layer-group"></i></div></div>
                <div><label for="alamat">Alamat Jalan</label><div class="input-group"><input type="text" id="alamat" placeholder="Nama jalan, nomor, RT/RW..."><i class="icon fa-solid fa-map-location-dot"></i></div></div>
                <div><label for="desaKelurahan">Desa / Kelurahan</label><div class="input-group"><input type="text" id="desaKelurahan" placeholder="Contoh: Cijantung"><i class="icon fa-solid fa-signs-post"></i></div></div>
                <div><label for="kecamatan">Kecamatan</label><div class="input-group"><input type="text" id="kecamatan" placeholder="Contoh: Pasar Rebo"><i class="icon fa-solid fa-map-marked-alt"></i></div></div>
                <div><label for="kabupatenKota">Kabupaten / Kota</label><div class="input-group"><input type="text" id="kabupatenKota" placeholder="Contoh: Jakarta Timur"><i class="icon fa-solid fa-city"></i></div></div>
                <div><label for="provinsi">Provinsi</label><div class="input-group"><input type="text" id="provinsi" placeholder="Contoh: DKI Jakarta"><i class="icon fa-solid fa-flag"></i></div></div>
                <div><label for="telpon">Telepon</label><div class="input-group"><input type="text" id="telpon" placeholder="Nomor telepon aktif..."><i class="icon fa-solid fa-phone"></i></div></div>
                <div><label for="website">Website</label><div class="input-group"><input type="text" id="website" placeholder="https://sekolah.sch.id"><i class="icon fa-solid fa-globe"></i></div></div>
                <div><label for="email">Email</label><div class="input-group"><input type="email" id="email" placeholder="kontak@sekolah.sch.id"><i class="icon fa-solid fa-envelope"></i></div></div>
                
                <div class="form-section-title">
                    <span>Personalia & Pengaturan Rapor</span><div class="line"></div>
                </div>
                <div><label for="kepalaSekolah">Nama Kepala Sekolah</label><div class="input-group"><input type="text" id="kepalaSekolah" placeholder="Nama lengkap & gelar..."><i class="icon fa-solid fa-user-tie"></i></div></div>
                <div><label for="nipKepsek">NIP Kepala Sekolah</label><div class="input-group"><input type="text" id="nipKepsek" placeholder="NIP tanpa spasi..."><i class="icon fa-solid fa-id-card"></i></div></div>
                <div><label for="namaGuru">Nama Guru / Wali Kelas</label><div class="input-group"><input type="text" id="namaGuru" required placeholder="Nama lengkap & gelar..."><i class="icon fa-solid fa-user-chalkboard"></i></div></div>
                <div><label for="nipGuru">NIP Guru Kelas</label><div class="input-group"><input type="text" id="nipGuru" placeholder="NIP/NUPTK/PegID..."><i class="icon fa-solid fa-id-card-clip"></i></div></div>
                <div><label for="whatsappGuru">Nomor WhatsApp Guru</label><div class="input-group"><input type="text" id="whatsappGuru" placeholder="Contoh: 081234567890"><i class="icon fa-brands fa-whatsapp"></i></div></div>
                <div><label for="kelas">Kelas</label><div class="input-group"><input type="text" id="kelas" placeholder="Contoh: IV A"><i class="icon fa-solid fa-person-shelter"></i></div></div>
                <div><label for="fase">Fase</label><div class="input-group"><input type="text" id="fase" placeholder="Contoh: B"><i class="icon fa-solid fa-star"></i></div></div>
                <div><label for="semester">Semester</label><div class="input-group"><select id="semester"><option value="1">1 (Ganjil)</option><option value="2">2 (Genap)</option></select><i class="icon fa-solid fa-calendar-days"></i></div></div>
                <div><label for="tahunAjaran">Tahun Ajaran</label><div class="input-group"><input type="text" id="tahunAjaran" placeholder="Contoh: 2024/2025" required><i class="icon fa-solid fa-graduation-cap"></i></div></div>
                <div><label for="tanggalRaporDepan">Tanggal Rapor (Halaman Depan)</label><div class="input-group"><input type="date" id="tanggalRaporDepan"><i class="icon fa-solid fa-file-signature"></i></div></div>
                <div><label for="tanggalRaporNilai">Tanggal Rapor (Halaman Nilai)</label><div class="input-group"><input type="date" id="tanggalRaporNilai"><i class="icon fa-solid fa-file-pen"></i></div></div>
            </div>

            <div class="submit-container">
                 <button type="submit"><i class="fa-solid fa-floppy-disk"></i>Simpan Semua Data</button>
            </div>
        </form>
    </div>

    <!-- STRUKTUR MODAL YANG WAJIB ADA UNTUK uhuuyy.js -->
    <!-- Tanpa ini, script uhuuyy.js akan error "Struktur HTML modal tidak ditemukan" -->
    <div id="actionConfirmModal" class="modal-backdrop">
        <div class="modal-content">
            <i id="modalActionIcon" class="modal-icon fa-solid fa-circle-check"></i>
            <h3 id="modalActionTitle">Judul Modal</h3>
            <p id="modalActionMessage">Pesan modal akan muncul di sini.</p>
            <div class="modal-actions">
                <button id="actionCancelBtn" class="modal-button" style="background-color: #ccc; color: #333;">Batal</button>
                <button id="actionConfirmBtn" class="modal-button" style="background-color: var(--primary-color); color: white;">OK</button>
            </div>
            <!-- Tombol close tersembunyi untuk keperluan script -->
            <div id="actionCloseBtn" style="display:none;"></div>
        </div>
    </div>

    <!-- Script uhuuyy.js dari upload user -->
    <script src="uhuuyy.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Memastikan data dimuat
            const dataRapor = loadData();
            const form = document.getElementById('formInfoDasar');

            // --- FUNGSI MENGIRIM DATA KE GOOGLE SHEET ---
            const sendDataToSheet = async (info) => {
                const webAppUrl = 'https://script.google.com/macros/s/AKfycbyuHIpJYfjg7Yf_FssU53sPcF5mUzV5vbfDriQafq-M6wWrK_lOjCBRYm65Ju-T4DFXTQ/exec'; 

                const dataToSend = {
                    timestamp: new Date().toLocaleString('id-ID', { timeZone: 'Asia/Jakarta' }),
                    namaGuru: info.namaGuru,
                    namaSekolah: info.namaSekolah,
                    desaKelurahan: info.desaKelurahan,
                    kecamatan: info.kecamatan,
                    kabupatenKota: info.kabupatenKota,
                    provinsi: info.provinsi,
                    whatsappGuru: info.whatsappGuru,
                    kelas: info.kelas,
                    jenjang: info.jenjang
                };

                try {
                    const response = await fetch(webAppUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                        body: JSON.stringify(dataToSend)
                    });
                } catch (error) {
                    console.error('Gagal menghubungi Google Sheet:', error);
                }
            };

            // --- LOGIKA UPLOAD LOGO ---
            const logoUploadInput = document.getElementById('logoUploadInput');
            const logoPreview = document.getElementById('logoPreview');
            const removeLogoButton = document.getElementById('removeLogoButton');
            const defaultLogo = 'https://www.kemendikdasmen.go.id/web/image/website/21/favicon?unique=c3563e4';

            const loadLogo = () => {
                if (dataRapor.infoDasar.logoSekolah && dataRapor.infoDasar.logoSekolah.startsWith('data:image')) {
                    logoPreview.src = dataRapor.infoDasar.logoSekolah;
                } else {
                    logoPreview.src = defaultLogo;
                }
            };
            
            logoUploadInput.addEventListener('change', function(event) {
                const file = event.target.files[0];
                if (file && file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const base64String = e.target.result;
                        logoPreview.src = base64String;
                        dataRapor.infoDasar.logoSekolah = base64String;
                    };
                    reader.readAsDataURL(file);
                }
            });

            removeLogoButton.addEventListener('click', () => {
                logoPreview.src = defaultLogo;
                dataRapor.infoDasar.logoSekolah = '';
                logoUploadInput.value = '';
            });

            // --- LOGIKA FORM ---
            const fieldIds = [
                'namaSekolah', 'npsn', 'jenjang', 'alamat', 'desaKelurahan', 'kecamatan', 'kabupatenKota', 
                'provinsi', 'website', 'email', 'telpon', 'kepalaSekolah', 'nipKepsek', 
                'namaGuru', 'nipGuru', 'whatsappGuru', 'kelas', 'fase', 'semester', 'tahunAjaran', 
                'tanggalRaporDepan', 'tanggalRaporNilai'
            ];
            
            const populateForm = () => {
                loadLogo();
                const info = dataRapor.infoDasar;
                fieldIds.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) { element.value = info[id] || ''; }
                });
            };
            
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                fieldIds.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) { dataRapor.infoDasar[id] = element.value; }
                });

                // 1. Simpan data ke LocalStorage
                saveData(dataRapor); 
                
                // 2. Kirim data ke Google Sheet
                sendDataToSheet(dataRapor.infoDasar);

                // 3. Tampilkan modal notifikasi sesuai instruksi
                // confirmText: 'Home' -> Tombol OK/Kanan
                // cancelText: 'Close' -> Tombol Batal/Kiri
                const userChoice = await showModal({
                    title: 'Simpan Berhasil',
                    message: 'Data sekolah berhasil disimpan.',
                    type: 'success',
                    confirmText: 'Home',    
                    cancelText: 'Close',    
                    showCancelButton: true
                });

                // Jika user klik "Home" (userChoice = true), pindah halaman
                if (userChoice) {
                    window.location.href = 'bangbin_Rapor.html';
                }
                // Jika user klik "Close" (userChoice = false), modal tertutup (default uhuuyy.js)
            });
            
            populateForm();
        });
    </script>
</body>
</html>
